import{d as $,r as c,O as q,o as W,b as _,w as s,u as a,I as J,e as E,f as K,S as N,a as X,g as o,h as Y,l as G,A as m,q as Q,s as u,k as i,v as Z,n as h,a2 as tt,a3 as T,m as et,E as at,a4 as ot,U as P,T as B,a5 as nt,a6 as st,M as lt,R as it,N as l,a7 as rt,X as ut,j as ct,a8 as dt,K as L,a9 as A,t as f,aa as ft,ab as pt,ac as gt,ad as D,_ as _t}from"./index-CaEhcsOJ.js";import{T as b}from"./index-DBI8ZE0l.js";const mt={key:0,class:"loading-container"},ht={key:1,class:"error-state"},vt={key:2,class:"empty-state"},yt={class:"preview-text"},It={key:0,class:"reactions-row"},kt={class:"notification-meta"},Nt={class:"date"},bt={key:0,class:"comments-count"},St=$({__name:"NotificationsPage",setup(wt){const S=localStorage.getItem("parisklegg_token")||"",w=localStorage.getItem("parisklegg_user");w&&JSON.parse(w);const R=e=>({like:D,heart:gt,"thumbs-up":pt})[e]||D,x=K(),p=c(!0),g=c(!1),v=c(!1),r=c([]),y=c(1),I=c(!0),d=async(e=1)=>{try{if(e===1?(p.value=!0,r.value=[]):g.value=!0,v.value=!1,!S)throw new Error("No authentication token found");const t=await E.get("https://school.klgilc.com/api/notifications",{headers:F(),timeout:1e4,params:{page:e}});e===1?r.value=t.data.data:r.value=[...r.value,...t.data.data],y.value=e,I.value=!!t.data.next_page_url,console.log("Notifications fetched successfully:",r.value)}catch(t){U(t),v.value=!0}finally{p.value=!1,g.value=!1}},V=async e=>{await d(y.value+1),e.target.complete()},H=e=>{const t=e.target;if(!t)return;const k=t.scrollHeight;t.scrollTop+t.clientHeight>k*.8&&I.value&&!g.value&&d(y.value+1)},j=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),z=(e,t)=>e.length<=t?e:e.substring(0,t)+"...",M=e=>{x.push("/notifications/".concat(e))};q(async()=>{await d()});const F=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(S)}),U=e=>{var t;if(console.error("Error fetching data:",e),E.isAxiosError(e)){if(((t=e.response)==null?void 0:t.status)===401){x.replace("/"),b.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(e.code==="ECONNABORTED"){b.show({text:"Request timeout. Please try again",position:"top"});return}}N.setOverlaysWebView({overlay:!1}),N.setBackgroundColor({color:"#ffffff"}),N.setStyle({style:X.Light}),b.show({text:"Failed to load data. Please try again later",position:"top"})};return W(()=>{d()}),(e,t)=>{const k=it("ion-chip");return l(),_(a(J),null,{default:s(()=>[o(a(Q),null,{default:s(()=>[o(a(Y),null,{default:s(()=>[o(a(G),null,{default:s(()=>t[2]||(t[2]=[m("Notifications",-1)])),_:1,__:[2]})]),_:1})]),_:1}),o(a(lt),{fullscreen:!0,onIonScroll:t[1]||(t[1]=n=>H(n))},{default:s(()=>[p.value&&!g.value?(l(),u("div",mt,[o(a(Z),{name:"crescent",color:"primary"}),t[3]||(t[3]=i("p",null,"Loading notifications...",-1))])):v.value?(l(),u("div",ht,[o(a(h),{icon:a(tt),color:"danger",size:"large"},null,8,["icon"]),o(a(T),null,{default:s(()=>t[4]||(t[4]=[i("h3",null,"Error Loading Notifications",-1),i("p",null,"Please try again later",-1)])),_:1,__:[4]}),o(a(et),{fill:"clear",onClick:d},{default:s(()=>t[5]||(t[5]=[m("Retry",-1)])),_:1,__:[5]})])):r.value.length===0&&!p.value?(l(),u("div",vt,[o(a(h),{icon:a(at),color:"medium",size:"large"},null,8,["icon"]),o(a(T),null,{default:s(()=>t[6]||(t[6]=[i("h3",null,"No Notifications",-1),i("p",null,"You don't have any notifications yet",-1)])),_:1,__:[6]})])):(l(),_(a(ot),{key:3},{default:s(()=>[(l(!0),u(B,null,P(r.value,n=>(l(),_(a(rt),{key:n.id,onClick:C=>M(n.id),class:ut(["notification-item",{unread:!n.is_read}])},{default:s(()=>[o(a(ct),{slot:"start",class:"notification-avatar"},{default:s(()=>t[7]||(t[7]=[i("img",{src:dt,alt:"School Logo"},null,-1)])),_:1,__:[7]}),o(a(L),null,{default:s(()=>[i("h2",null,f(n.title),1),i("p",yt,f(z(n.body,60)),1),n.reaction_counts&&Object.keys(n.reaction_counts).length?(l(),u("div",It,[(l(!0),u(B,null,P(n.reaction_counts,(C,O)=>(l(),_(k,{key:O,color:"light",class:"reaction-chip"},{default:s(()=>[o(a(h),{icon:R(O)},null,8,["icon"]),o(a(L),null,{default:s(()=>[m(f(C),1)]),_:2},1024)]),_:2},1024))),128))])):A("",!0),i("div",kt,[i("span",Nt,f(j(n.created_at)),1),n.comments_count?(l(),u("span",bt,[o(a(h),{icon:a(ft)},null,8,["icon"]),m(" "+f(n.comments_count),1)])):A("",!0)])]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})),o(a(nt),{onIonInfinite:t[0]||(t[0]=n=>V(n)),threshold:"100px",disabled:!I.value},{default:s(()=>[o(a(st),{"loading-spinner":"bubbles","loading-text":"Loading more notifications..."})]),_:1},8,["disabled"])]),_:1})]),_:1})}}}),Ot=_t(St,[["__scopeId","data-v-ace97c71"]]);export{Ot as default};
