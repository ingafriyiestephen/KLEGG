import{d as pe,r,ao as _e,c as fe,o as ge,P as he,a as p,w as l,u as a,I as ke,b as _,e as we,f as ye,g as o,h as Ie,L as be,aq as Ce,m as Se,B as b,s as $e,v as C,a9 as T,x as N,p as g,a1 as xe,a2 as Ne,l as d,n as h,y as Re,z as De,A as Ee,t as v,aQ as Oe,D as Be,R as U,S as H,aR as Pe,a3 as Ve,aS as ze,a8 as K,a4 as Le,a5 as Ae,a6 as ee,aT as Te,aU as Ue,aV as He,N as te,aW as Me,aX as Fe,O as u,k as Je,ab as ae,aY as je,aZ as qe,a_ as We,ac as Ze,ad as oe,_ as Ge}from"./index-Bfnbz8KY.js";import{T as M}from"./index-CmNb0h0M.js";const Qe={key:0,class:"loading-container"},Xe={key:1,class:"error-state"},Ye={key:2},Ke={class:"notification-body"},et={class:"reactions-container"},tt={class:"comments-section"},at=["src"],ot={class:"comment-date"},nt={slot:"end",class:"vote-buttons"},lt={class:"vote-count"},st={class:"vote-count"},it={class:"comment-input-container"},rt=pe({__name:"NotificationPage",setup(ut){const ne=localStorage.getItem("parisklegg_token")||"",F=localStorage.getItem("parisklegg_user");F&&JSON.parse(F);let R=null;const D=r({name:"",id:0,otp:0,phone:""}),le=_e(),se=we(),w=Number(le.params.id),E=r(!0),O=r(!1),B=r(!1),k=r(!1),S=r(!1),s=r(null),m=r([]),P=r(1),J=r(!0),y=r(""),$=r(null),x=r(!1),V=r(null),j=r(0),ie=["like","heart","thumbs-up"],z=fe(()=>{var e,t;return((t=(e=s.value)==null?void 0:e.user_reaction)==null?void 0:t.reaction_type)||null}),q=e=>({like:oe,heart:Ze,"thumbs-up":ae})[e]||oe,W=e=>{if(!e)return"Just now";const t=e.replace(/\.\d{6}Z$/,""),c=new Date(t);if(isNaN(c.getTime()))return"Invalid date";const n=c.toLocaleString("en-US",{month:"short"}),i=c.getDate(),I=String(c.getHours()).padStart(2,"0"),A=String(c.getMinutes()).padStart(2,"0");return"".concat(n," ").concat(i,", ").concat(I,":").concat(A)},Z=async()=>{try{E.value=!0,O.value=!1;const e=await _.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat(w),{headers:f(),timeout:2e4});s.value=e.data,console.log("Notification loaded:",e.data),e.data.is_read===0&&await _.post("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat(w,"/read"),{},{headers:f(),timeout:1e4}),await L()}catch(e){console.error("Error loading notification:",e),ve(e),O.value=!0}finally{E.value=!1}},L=async(e=1)=>{try{const t=await _.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat(w,"/comments"),{params:{page:e},headers:f(),timeout:1e4});e===1?m.value=t.data.data:m.value=[...m.value,...t.data.data],P.value=e,J.value=!!t.data.next_page_url}catch(t){console.error("Error loading comments:",t)}},re=async e=>{await L(P.value+1),e.target.complete()},ue=async()=>{if(y.value.trim()){B.value=!0;try{const e=await _.post("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat(w,"/create_comment"),{comment_body:y.value},{headers:f(),timeout:1e4}),t={id:e.data.comment.id,comment_body:e.data.comment.comment_body,created_at:e.data.comment.created_at,user_id:e.data.comment.user_id,user_name:e.data.comment.user_name,avatar:e.data.comment.avatar||null,upvotes_count:0,downvotes_count:0,user_vote:null};m.value.unshift(t),y.value="",s.value&&(s.value.comments_count+=1)}catch(e){console.error("Error adding comment:",e)}finally{B.value=!1}}},ce=async e=>{$.value=e;try{await _.delete("https://klegg-app-whh7m.ondigitalocean.app/api/comments/".concat(e),{headers:f(),timeout:1e4}),m.value=m.value.filter(t=>t.id!==e),s.value&&(s.value.comments_count-=1)}catch(t){console.error("Error deleting comment:",t)}finally{$.value=null}},de=async e=>{z.value===e?await me():await Q(e)},G=async(e,t)=>{if(!S.value){S.value=!0;try{const c=m.value.findIndex(A=>A.id===e);if(c===-1)return;const n=m.value[c],i=n.user_vote;i===t?(n.user_vote=null,t==="upvote"&&n.upvotes_count--,t==="downvote"&&n.downvotes_count--):(i==="upvote"&&n.upvotes_count--,i==="downvote"&&n.downvotes_count--,n.user_vote=t,t==="upvote"&&n.upvotes_count++,t==="downvote"&&n.downvotes_count++);const I=await _.post("https://klegg-app-whh7m.ondigitalocean.app/api/comments/".concat(e,"/vote"),{vote_type:t},{headers:f(),timeout:1e4});m.value[c]={...m.value[c],upvotes_count:I.data.upvotes_count,downvotes_count:I.data.downvotes_count,user_vote:I.data.user_vote}}catch(c){console.error("Error voting on comment:",c),L(P.value)}finally{S.value=!1}}},Q=async e=>{k.value=!0,x.value=!1;try{const t=await _.post("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat(w,"/reactions"),{reaction_type:e},{headers:f(),timeout:1e4});s.value&&(s.value.reaction_counts=t.data.reaction_counts,s.value.user_reaction={reaction_type:e},V.value=t.data.reaction_id,console.log("Reaction added:",V.value))}catch(t){console.error("Error adding reaction:",t)}finally{k.value=!1}},me=async()=>{k.value=!0;try{const e=await _.delete("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat(w,"/delete_reaction"),{headers:f(),timeout:1e4});s.value&&(s.value.reaction_counts=e.data.reaction_counts,V.value=0,s.value.user_reaction=null)}catch(e){console.error("Error removing reaction:",e)}finally{k.value=!1}},f=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(ne)}),ve=e=>{var t;if(console.error("Error fetching data:",e),_.isAxiosError(e)){if(((t=e.response)==null?void 0:t.status)===401){se.replace("/"),M.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(e.code==="ECONNABORTED"){M.show({text:"Request timeout. Please try again",position:"top"});return}}M.show({text:"Failed to load data. Please try again later",position:"top"})},X=e=>{const t=e.matches;ye(t)},Y=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");return X(e),e.addEventListener("change",X),e};return ge(()=>{Y(),Z();const e=localStorage.getItem("parisklegg_user");if(e){const t=JSON.parse(e);t&&(D.value.name=t.fullname,D.value.id=t.user_id,D.value.email=t.username,R=t.user_id)}j.value=R?Number(R):0}),he(async()=>{Y()}),(e,t)=>{const c=be("ion-buttons");return u(),p(a(ke),null,{default:l(()=>[o(a($e),null,{default:l(()=>[o(a(Ie),null,{default:l(()=>[o(c,{slot:"start"},{default:l(()=>[o(a(Ce))]),_:1}),o(a(Se),null,{default:l(()=>[...t[3]||(t[3]=[b(" Notification ",-1)])]),_:1})]),_:1})]),_:1}),o(a(te),{fullscreen:!0},{default:l(()=>[E.value?(u(),C("div",Qe,[o(a(N),{name:"crescent",color:"primary"})])):O.value?(u(),C("div",Xe,[o(a(g),{icon:a(xe),color:"danger",size:"large"},null,8,["icon"]),o(a(Ne),null,{default:l(()=>[...t[4]||(t[4]=[d("h3",null,"Error Loading Notification",-1),d("p",null,"Please try again later",-1)])]),_:1}),o(a(h),{fill:"clear",onClick:Z},{default:l(()=>[...t[5]||(t[5]=[b("Retry",-1)])]),_:1})])):s.value?(u(),C("div",Ye,[o(a(Re),{class:"notification-card"},{default:l(()=>[o(a(De),null,{default:l(()=>[o(a(Ee),{class:"notification-title"},{default:l(()=>[b(v(s.value.title),1)]),_:1}),o(a(Oe),null,{default:l(()=>[b(v(W(s.value.created_at)),1)]),_:1})]),_:1}),o(a(Be),null,{default:l(()=>[d("p",Ke,v(s.value.body),1),d("div",et,[(u(!0),C(U,null,H(s.value.reaction_counts,(n,i)=>(u(),p(a(h),{key:i,fill:"clear",size:"small",onClick:I=>de(i),color:z.value===i?"primary":"medium",disabled:k.value},{default:l(()=>[k.value&&z.value===i?(u(),p(a(N),{key:0,name:"dots",slot:"start"})):(u(),p(a(g),{key:1,icon:q(i),slot:"start"},null,8,["icon"])),b(" "+v(n),1)]),_:2},1032,["onClick","color","disabled"]))),128)),o(a(h),{fill:"clear",size:"small",onClick:t[0]||(t[0]=n=>x.value=!0),disabled:k.value},{default:l(()=>[o(a(g),{icon:a(Pe),slot:"icon-only"},null,8,["icon"])]),_:1},8,["disabled"])])]),_:1})]),_:1}),d("div",tt,[o(a(Ve),null,{default:l(()=>[o(a(ze),null,{default:l(()=>[o(a(K),null,{default:l(()=>[b("Comments ("+v(s.value.comments_count)+")",1)]),_:1})]),_:1}),(u(!0),C(U,null,H(m.value,n=>(u(),p(a(ee),{key:n.id,class:"comment-item"},{default:l(()=>[o(a(Je),{slot:"start",style:{"margin-left":"20px"}},{default:l(()=>[d("img",{src:n.avatar||"/assets/img/default-avatar.svg"},null,8,at)]),_:2},1024),o(a(K),null,{default:l(()=>[d("h3",null,v(n.user_name),1),d("p",null,v(n.comment_body),1),d("p",ot,v(W(n.created_at)),1)]),_:2},1024),d("div",nt,[o(a(h),{fill:"clear",size:"small",onClick:i=>G(n.id,"upvote"),disabled:S.value},{default:l(()=>[o(a(g),{icon:a(ae),color:n.user_vote==="upvote"?"primary":"medium"},null,8,["icon","color"]),d("span",lt,v(n.upvotes_count),1)]),_:2},1032,["onClick","disabled"]),o(a(h),{fill:"clear",size:"small",onClick:i=>G(n.id,"downvote"),disabled:S.value},{default:l(()=>[o(a(g),{icon:a(je),color:n.user_vote==="downvote"?"danger":"medium"},null,8,["icon","color"]),d("span",st,v(n.downvotes_count),1)]),_:2},1032,["onClick","disabled"])]),n.user_id===j.value?(u(),p(a(h),{key:0,fill:"clear",color:"danger",onClick:i=>ce(n.id),disabled:$.value===n.id},{default:l(()=>[$.value===n.id?(u(),p(a(N),{key:0,name:"dots",slot:"icon-only"})):(u(),p(a(g),{key:1,icon:a(qe),slot:"icon-only"},null,8,["icon"]))]),_:2},1032,["onClick","disabled"])):T("",!0)]),_:2},1024))),128)),o(a(Le),{onIonInfinite:re,threshold:"100px",disabled:!J.value},{default:l(()=>[o(a(Ae),{"loading-spinner":"bubbles","loading-text":"Loading more comments..."})]),_:1},8,["disabled"])]),_:1})]),d("div",it,[o(a(ee),null,{default:l(()=>[o(a(Te),{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=n=>y.value=n),placeholder:"Add a comment...","auto-grow":""},null,8,["modelValue"]),o(a(h),{slot:"end",fill:"clear",disabled:!y.value.trim(),onClick:ue},{default:l(()=>[B.value?(u(),p(a(N),{key:0,slot:"start",name:"dots"})):T("",!0),o(a(g),{icon:a(Ue),color:"primary"},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})])])):T("",!0),o(a(He),{"is-open":x.value,onDidDismiss:t[2]||(t[2]=n=>x.value=!1)},{default:l(()=>[o(a(te),null,{default:l(()=>[o(a(Me),null,{default:l(()=>[o(a(Fe),null,{default:l(()=>[(u(),C(U,null,H(ie,n=>o(a(We),{key:n,size:"auto",onClick:i=>Q(n)},{default:l(()=>[o(a(h),{fill:"clear"},{default:l(()=>[o(a(g),{icon:q(n),size:"large"},null,8,["icon"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1})}}}),mt=Ge(rt,[["__scopeId","data-v-7b18e8a8"]]);export{mt as default};
