import{d as Ee,r as u,ap as Se,c as De,o as Ne,P as Oe,a as m,w as l,u as a,I as Le,b as y,e as Re,f as Fe,g as o,h as Pe,L as Be,ar as ze,m as Ve,B as S,s as Ae,v,aa as I,x as C,p as f,a2 as Me,a3 as Te,l as c,n as h,y as Ue,z as He,A as je,t as g,aW as Je,D as We,aX as re,aY as ue,a7 as j,aO as Ze,a9 as J,T as qe,aI as Ge,R as W,S as Z,aZ as Xe,a4 as Ye,a_ as Ke,a5 as Qe,a6 as et,a$ as tt,b0 as at,b1 as ot,N as q,b2 as nt,b3 as lt,b4 as st,aH as it,O as i,k as rt,ac as ce,b5 as ut,b6 as ct,b7 as dt,ad as mt,ae as de,_ as vt}from"./index-KRMmF5hz.js";import{T as D}from"./index-DxolAIpy.js";const pt={key:0,class:"loading-container"},ft={key:1,class:"error-state"},gt={key:2},_t={class:"notification-body"},ht={key:0,class:"attachment-container"},yt={key:0,class:"image-skeleton"},wt=["src"],kt={key:1,class:"file-attachment"},bt={key:0,class:"file-loading",slot:"start"},It={class:"reactions-container"},Ct={class:"comments-section"},$t=["src"],xt={class:"comment-date"},Et={slot:"end",class:"vote-buttons"},St={class:"vote-count"},Dt={class:"vote-count"},Nt={class:"comment-input-container"},Ot={key:0,class:"modal-content"},Lt={key:0,class:"modal-loading"},Rt=["src","alt"],Ft=Ee({__name:"NotificationPage",setup(Pt){const me=localStorage.getItem("parisklegg_token")||"",G=localStorage.getItem("parisklegg_user");G&&JSON.parse(G);let F=null;const P=u({name:"",id:0,otp:0,phone:""}),ve=Se(),pe=Re(),$=Number(ve.params.id),B=u(!0),z=u(!1),V=u(!1),k=u(!1),N=u(!1),s=u(null),p=u([]),A=u(1),X=u(!0),x=u(""),L=u(null),R=u(!1),M=u(null),Y=u(0),b=u(null),fe=["like","heart","thumbs-up"],T=De(()=>{var t,e;return((e=(t=s.value)==null?void 0:t.user_reaction)==null?void 0:e.reaction_type)||null}),K=t=>({like:de,heart:mt,"thumbs-up":ce})[t]||de,Q=t=>{if(!t)return"Just now";const e=t.replace(/\.\d{6}Z$/,""),r=new Date(e);if(isNaN(r.getTime()))return"Invalid date";const n=r.toLocaleString("en-US",{month:"short"}),d=r.getDate(),E=String(r.getHours()).padStart(2,"0"),H=String(r.getMinutes()).padStart(2,"0");return"".concat(n," ").concat(d,", ").concat(E,":").concat(H)},_=u(!1),O=u(!1),ge=()=>{_.value=!1},_e=()=>{O.value=!1},he=t=>{O.value=!1;const e=t.target;e.style.opacity="0.5",e.alt="Failed to load image"},ee=t=>"https://storage.draugustinaosabutey.com/api/files/".concat(t,"/view"),te=t=>[".png",".jpg",".jpeg",".gif",".webp",".bmp",".svg"].some(r=>t.toLowerCase().endsWith(r)),ye=t=>{b.value=t,O.value=!0},we=t=>{_.value=!1;const e=t.target;e.style.opacity="0.5",e.alt="Failed to load image"},ae=async(t,e="view")=>{try{const r=await D.show({text:e==="view"?"Opening file...":"Opening file for download...",position:"top"}),n="https://storage.draugustinaosabutey.com/api/files/".concat(t,"/view");window.open(n,"_blank"),await D.show({text:"File opened successfully",position:"top",duration:"short"})}catch(r){console.error("File access error:",r),await D.show({text:"Failed to open file. Please try again.",position:"top",duration:"long"})}},oe=async()=>{var t;try{B.value=!0,z.value=!1,_.value=!1;const e=await y.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat($),{headers:w(),timeout:2e4});s.value=e.data,console.log("Notification loaded:",e.data),(t=s.value)!=null&&t.attachment&&te(s.value.attachment)&&(_.value=!0),e.data.is_read===0&&await y.post("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat($,"/read"),{},{headers:w(),timeout:1e4}),await U()}catch(e){console.error("Error loading notification:",e),xe(e),z.value=!0}finally{B.value=!1}},U=async(t=1)=>{try{const e=await y.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat($,"/comments"),{params:{page:t},headers:w(),timeout:1e4});t===1?p.value=e.data.data:p.value=[...p.value,...e.data.data],A.value=t,X.value=!!e.data.next_page_url}catch(e){console.error("Error loading comments:",e)}},ke=async t=>{await U(A.value+1),t.target.complete()},be=async()=>{if(x.value.trim()){V.value=!0;try{const t=await y.post("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat($,"/create_comment"),{comment_body:x.value},{headers:w(),timeout:1e4}),e={id:t.data.comment.id,comment_body:t.data.comment.comment_body,created_at:t.data.comment.created_at,user_id:t.data.comment.user_id,user_name:t.data.comment.user_name,avatar:t.data.comment.avatar||null,upvotes_count:0,downvotes_count:0,user_vote:null};p.value.unshift(e),x.value="",s.value&&(s.value.comments_count+=1)}catch(t){console.error("Error adding comment:",t)}finally{V.value=!1}}},Ie=async t=>{L.value=t;try{await y.delete("https://klegg-app-whh7m.ondigitalocean.app/api/comments/".concat(t),{headers:w(),timeout:1e4}),p.value=p.value.filter(e=>e.id!==t),s.value&&(s.value.comments_count-=1)}catch(e){console.error("Error deleting comment:",e)}finally{L.value=null}},Ce=async t=>{T.value===t?await $e():await le(t)},ne=async(t,e)=>{if(!N.value){N.value=!0;try{const r=p.value.findIndex(H=>H.id===t);if(r===-1)return;const n=p.value[r],d=n.user_vote;d===e?(n.user_vote=null,e==="upvote"&&n.upvotes_count--,e==="downvote"&&n.downvotes_count--):(d==="upvote"&&n.upvotes_count--,d==="downvote"&&n.downvotes_count--,n.user_vote=e,e==="upvote"&&n.upvotes_count++,e==="downvote"&&n.downvotes_count++);const E=await y.post("https://klegg-app-whh7m.ondigitalocean.app/api/comments/".concat(t,"/vote"),{vote_type:e},{headers:w(),timeout:1e4});p.value[r]={...p.value[r],upvotes_count:E.data.upvotes_count,downvotes_count:E.data.downvotes_count,user_vote:E.data.user_vote}}catch(r){console.error("Error voting on comment:",r),U(A.value)}finally{N.value=!1}}},le=async t=>{k.value=!0,R.value=!1;try{const e=await y.post("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat($,"/reactions"),{reaction_type:t},{headers:w(),timeout:1e4});s.value&&(s.value.reaction_counts=e.data.reaction_counts,s.value.user_reaction={reaction_type:t},M.value=e.data.reaction_id,console.log("Reaction added:",M.value))}catch(e){console.error("Error adding reaction:",e)}finally{k.value=!1}},$e=async()=>{k.value=!0;try{const t=await y.delete("https://klegg-app-whh7m.ondigitalocean.app/api/notifications/".concat($,"/delete_reaction"),{headers:w(),timeout:1e4});s.value&&(s.value.reaction_counts=t.data.reaction_counts,M.value=0,s.value.user_reaction=null)}catch(t){console.error("Error removing reaction:",t)}finally{k.value=!1}},w=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(me)}),xe=t=>{var e;if(console.error("Error fetching data:",t),y.isAxiosError(t)){if(((e=t.response)==null?void 0:e.status)===401){pe.replace("/"),D.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(t.code==="ECONNABORTED"){D.show({text:"Request timeout. Please try again",position:"top"});return}}D.show({text:"Failed to load data. Please try again later",position:"top"})},se=t=>{const e=t.matches;Fe(e)},ie=()=>{const t=window.matchMedia("(prefers-color-scheme: dark)");return se(t),t.addEventListener("change",se),t};return Ne(()=>{ie(),oe();const t=localStorage.getItem("parisklegg_user");if(t){const e=JSON.parse(t);e&&(P.value.name=e.fullname,P.value.id=e.user_id,P.value.email=e.username,F=e.user_id)}Y.value=F?Number(F):0}),Oe(async()=>{ie()}),(t,e)=>{const r=Be("ion-buttons");return i(),m(a(Le),null,{default:l(()=>[o(a(Ae),null,{default:l(()=>[o(a(Pe),null,{default:l(()=>[o(r,{slot:"start"},{default:l(()=>[o(a(ze))]),_:1}),o(a(Ve),null,{default:l(()=>[...e[8]||(e[8]=[S(" Notification ",-1)])]),_:1})]),_:1})]),_:1}),o(a(q),{fullscreen:!0},{default:l(()=>[B.value?(i(),v("div",pt,[o(a(C),{name:"crescent",color:"primary"})])):z.value?(i(),v("div",ft,[o(a(f),{icon:a(Me),color:"danger",size:"large"},null,8,["icon"]),o(a(Te),null,{default:l(()=>[...e[9]||(e[9]=[c("h3",null,"Error Loading Notification",-1),c("p",null,"Please try again later",-1)])]),_:1}),o(a(h),{fill:"clear",onClick:oe},{default:l(()=>[...e[10]||(e[10]=[S("Retry",-1)])]),_:1})])):s.value?(i(),v("div",gt,[o(a(Ue),{class:"notification-card"},{default:l(()=>[o(a(He),null,{default:l(()=>[o(a(je),{class:"notification-title"},{default:l(()=>[S(g(s.value.title),1)]),_:1}),o(a(Je),null,{default:l(()=>[S(g(Q(s.value.created_at)),1)]),_:1})]),_:1}),o(a(We),null,{default:l(()=>[c("p",_t,g(s.value.body),1),s.value.attachment&&te(s.value.attachment)?(i(),v("div",ht,[_.value?(i(),v("div",yt)):I("",!0),re(c("img",{src:ee(s.value.attachment),class:"attachment-image",onLoad:ge,onError:we,onClick:e[0]||(e[0]=n=>ye(s.value.attachment))},null,40,wt),[[ue,!_.value]])])):s.value.attachment?(i(),v("div",kt,[o(a(j),{button:"",onClick:e[2]||(e[2]=n=>ae(s.value.attachment)),disabled:_.value},{default:l(()=>[_.value?(i(),v("div",bt,[o(a(C),{name:"dots",color:"primary"})])):(i(),m(a(f),{key:1,icon:a(Ze),slot:"start",color:"primary"},null,8,["icon"])),o(a(J),null,{default:l(()=>[c("h3",null,g(s.value.attachment),1),e[11]||(e[11]=c("p",null,"File Attachment",-1))]),_:1}),o(a(h),{fill:"clear",slot:"end",onClick:e[1]||(e[1]=qe(n=>ae(s.value.attachment),["stop"])),disabled:_.value},{default:l(()=>[_.value?(i(),m(a(C),{key:0,name:"dots"})):(i(),m(a(f),{key:1,icon:a(Ge)},null,8,["icon"]))]),_:1},8,["disabled"])]),_:1},8,["disabled"])])):I("",!0),c("div",It,[(i(!0),v(W,null,Z(s.value.reaction_counts,(n,d)=>(i(),m(a(h),{key:d,fill:"clear",size:"small",onClick:E=>Ce(d),color:T.value===d?"primary":"medium",disabled:k.value},{default:l(()=>[k.value&&T.value===d?(i(),m(a(C),{key:0,name:"dots",slot:"start"})):(i(),m(a(f),{key:1,icon:K(d),slot:"start"},null,8,["icon"])),S(" "+g(n),1)]),_:2},1032,["onClick","color","disabled"]))),128)),o(a(h),{fill:"clear",size:"small",onClick:e[3]||(e[3]=n=>R.value=!0),disabled:k.value},{default:l(()=>[o(a(f),{icon:a(Xe),slot:"icon-only"},null,8,["icon"])]),_:1},8,["disabled"])])]),_:1})]),_:1}),c("div",Ct,[o(a(Ye),null,{default:l(()=>[o(a(Ke),null,{default:l(()=>[o(a(J),null,{default:l(()=>[S("Comments ("+g(s.value.comments_count)+")",1)]),_:1})]),_:1}),(i(!0),v(W,null,Z(p.value,n=>(i(),m(a(j),{key:n.id,class:"comment-item"},{default:l(()=>[o(a(rt),{slot:"start",style:{"margin-left":"20px"}},{default:l(()=>[c("img",{src:n.avatar||"/assets/img/default-avatar.svg"},null,8,$t)]),_:2},1024),o(a(J),null,{default:l(()=>[c("h3",null,g(n.user_name),1),c("p",null,g(n.comment_body),1),c("p",xt,g(Q(n.created_at)),1)]),_:2},1024),c("div",Et,[o(a(h),{fill:"clear",size:"small",onClick:d=>ne(n.id,"upvote"),disabled:N.value},{default:l(()=>[o(a(f),{icon:a(ce),color:n.user_vote==="upvote"?"primary":"medium"},null,8,["icon","color"]),c("span",St,g(n.upvotes_count),1)]),_:2},1032,["onClick","disabled"]),o(a(h),{fill:"clear",size:"small",onClick:d=>ne(n.id,"downvote"),disabled:N.value},{default:l(()=>[o(a(f),{icon:a(ut),color:n.user_vote==="downvote"?"danger":"medium"},null,8,["icon","color"]),c("span",Dt,g(n.downvotes_count),1)]),_:2},1032,["onClick","disabled"])]),n.user_id===Y.value?(i(),m(a(h),{key:0,fill:"clear",color:"danger",onClick:d=>Ie(n.id),disabled:L.value===n.id},{default:l(()=>[L.value===n.id?(i(),m(a(C),{key:0,name:"dots",slot:"icon-only"})):(i(),m(a(f),{key:1,icon:a(ct),slot:"icon-only"},null,8,["icon"]))]),_:2},1032,["onClick","disabled"])):I("",!0)]),_:2},1024))),128)),o(a(Qe),{onIonInfinite:ke,threshold:"100px",disabled:!X.value},{default:l(()=>[o(a(et),{"loading-spinner":"bubbles","loading-text":"Loading more comments..."})]),_:1},8,["disabled"])]),_:1})]),c("div",Nt,[o(a(j),null,{default:l(()=>[o(a(tt),{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=n=>x.value=n),placeholder:"Add a comment...","auto-grow":""},null,8,["modelValue"]),o(a(h),{slot:"end",fill:"clear",disabled:!x.value.trim(),onClick:be},{default:l(()=>[V.value?(i(),m(a(C),{key:0,slot:"start",name:"dots"})):I("",!0),o(a(f),{icon:a(at),color:"primary"},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})])])):I("",!0),o(a(ot),{"is-open":R.value,onDidDismiss:e[5]||(e[5]=n=>R.value=!1)},{default:l(()=>[o(a(q),null,{default:l(()=>[o(a(nt),null,{default:l(()=>[o(a(lt),null,{default:l(()=>[(i(),v(W,null,Z(fe,n=>o(a(dt),{key:n,size:"auto",onClick:d=>le(n)},{default:l(()=>[o(a(h),{fill:"clear"},{default:l(()=>[o(a(f),{icon:K(n),size:"large"},null,8,["icon"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"]),o(a(st),{"is-open":!!b.value,onDidDismiss:e[7]||(e[7]=n=>b.value=null),class:"image-modal"},{default:l(()=>[o(a(q),null,{default:l(()=>[b.value?(i(),v("div",Ot,[O.value?(i(),v("div",Lt,[o(a(C),{name:"crescent",color:"light"}),e[12]||(e[12]=c("p",null,"Loading image...",-1))])):I("",!0),re(c("img",{src:ee(b.value),alt:b.value,class:"modal-image",onLoad:_e,onError:he},null,40,Rt),[[ue,!O.value]]),o(a(h),{fill:"clear",color:"light",class:"close-btn",onClick:e[6]||(e[6]=n=>b.value=null)},{default:l(()=>[o(a(f),{icon:a(it)},null,8,["icon"])]),_:1})])):I("",!0)]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1})}}}),Vt=vt(Ft,[["__scopeId","data-v-a6d15329"]]);export{Vt as default};
