System.register(["./index-legacy-LZepmReL.js","./index-legacy-DduMCVS-.js"],function(e,t){"use strict";var a,o,l,n,i,r,c,s,d,u,m,v,p,g,f,_,h,y,x,b,k,w,C,z,S,$,E,N,I,j,P,A,R,T,D,O,V,L,U,B,q,J,M,W,F,H,K,Q,X,Z,G,Y,ee,te,ae,oe,le,ne,ie;return{setters:[e=>{a=e.d,o=e.ao,l=e.r,n=e.c,i=e.S,r=e.a,c=e.o,s=e.b,d=e.w,u=e.u,m=e.I,v=e.e,p=e.f,g=e.g,f=e.h,_=e.R,h=e.P,y=e.l,x=e.A,b=e.q,k=e.s,w=e.a9,C=e.v,z=e.n,S=e.a2,$=e.a3,E=e.k,N=e.m,I=e.x,j=e.y,P=e.z,A=e.t,R=e.aN,T=e.C,D=e.T,O=e.U,V=e.aO,L=e.a4,U=e.aP,B=e.K,q=e.a5,J=e.a6,M=e.a7,W=e.aQ,F=e.aR,H=e.aS,K=e.M,Q=e.aT,X=e.aU,Z=e.N,G=e.j,Y=e.ab,ee=e.aV,te=e.aW,ae=e.aX,oe=e.ac,le=e.ad,ne=e._},e=>{ie=e.T}],execute:function(){var t=document.createElement("style");t.textContent=".loading-container[data-v-8c639770]{display:flex;justify-content:center;align-items:center;height:100px;margin:20px 0}.error-state[data-v-8c639770]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;height:60vh;padding:20px}.error-state ion-icon[data-v-8c639770]{margin-bottom:16px}.error-state h3[data-v-8c639770]{font-size:1.2rem;font-weight:500;margin-bottom:8px;color:var(--ion-color-dark)}.error-state p[data-v-8c639770]{font-size:.9rem;color:var(--ion-color-medium);margin-bottom:16px}.notification-card[data-v-8c639770]{margin:0;border-radius:0;box-shadow:none;border-bottom:1px solid var(--ion-color-light)}.notification-body[data-v-8c639770]{font-size:1rem;line-height:1.5;color:var(--ion-color-dark);white-space:pre-line}.reactions-container[data-v-8c639770]{display:flex;gap:8px;margin-top:16px;padding-top:16px;border-top:1px solid var(--ion-color-light)}.comments-section[data-v-8c639770]{margin-top:16px}.comment-item[data-v-8c639770]{--padding-start: 0;--inner-padding-end: 0}.comment-item ion-avatar[data-v-8c639770]{width:40px;height:40px;margin-right:12px}.comment-item h3[data-v-8c639770]{font-size:.9rem;font-weight:500}.comment-item p[data-v-8c639770]{font-size:.9rem;color:var(--ion-color-dark);margin:4px 0}.comment-date[data-v-8c639770]{font-size:.7rem;color:var(--ion-color-medium)}.comment-input-container[data-v-8c639770]{position:sticky;bottom:0;background:var(--ion-background-color);padding:8px;border-top:1px solid var(--ion-color-light)}.comment-input-container ion-textarea[data-v-8c639770]{background:var(--ion-color-light);border-radius:20px;--padding-start: 12px;--padding-end: 12px;font-size:.9rem}ion-popover ion-content[data-v-8c639770]{--padding-start: 8px;--padding-end: 8px;--padding-top: 8px;--padding-bottom: 8px}.reactions-container[data-v-8c639770]{display:flex;align-items:center;gap:4px}ion-icon[data-v-8c639770]{width:16px;height:16px}.vote-buttons[data-v-8c639770]{display:flex;flex-direction:column;align-items:center;margin-right:8px}.vote-count[data-v-8c639770]{font-size:.8em;margin-left:4px}\n",document.head.appendChild(t);const re={key:0,class:"loading-container"},ce={key:1,class:"error-state"},se={key:2},de={class:"notification-body"},ue={class:"reactions-container"},me={class:"comments-section"},ve=["src"],pe={class:"comment-date"},ge={slot:"end",class:"vote-buttons"},fe={class:"vote-count"},_e={class:"vote-count"},he={class:"comment-input-container"};e("default",ne(a({__name:"NotificationPage",setup(e){const t=localStorage.getItem("parisklegg_token")||"",a=localStorage.getItem("parisklegg_user");a&&JSON.parse(a);const ne=o(),ye=p(),xe=Number(ne.params.id),be=l(!0),ke=l(!1),we=l(!1),Ce=l(!1),ze=l(!1),Se=l(null),$e=l([]),Ee=l(1),Ne=l(!0),Ie=l(""),je=l(null),Pe=l(!1),Ae=l(null),Re=l(0),Te=["like","heart","thumbs-up"],De=n(()=>{var e;return(null===(e=Se.value)||void 0===e||null===(e=e.user_reaction)||void 0===e?void 0:e.reaction_type)||null}),Oe=e=>({like:le,heart:oe,"thumbs-up":Y}[e]||le),Ve=e=>{if(!e)return"Just now";const t=e.replace(/\.\d{6}Z$/,""),a=new Date(t);return isNaN(a.getTime())?"Invalid date":`${a.toLocaleString("en-US",{month:"short"})} ${a.getDate()}, ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},Le=async()=>{try{be.value=!0,ke.value=!1;const e=await v.get(`https://school.klgilc.com/api/notifications/${xe}`,{headers:Fe(),timeout:2e4});Se.value=e.data,console.log("Notification loaded:",e.data),0===e.data.is_read&&await v.post(`https://school.klgilc.com/api/notifications/${xe}/read`,{},{headers:Fe(),timeout:1e4}),await Ue()}catch(e){console.error("Error loading notification:",e),He(e),ke.value=!0}finally{be.value=!1}},Ue=async(e=1)=>{try{const t=await v.get(`https://school.klgilc.com/api/notifications/${xe}/comments`,{params:{page:e},headers:Fe(),timeout:1e4});$e.value=1===e?t.data.data:[...$e.value,...t.data.data],Ee.value=e,Ne.value=!!t.data.next_page_url}catch(t){console.error("Error loading comments:",t)}},Be=async e=>{await Ue(Ee.value+1),e.target.complete()},qe=async()=>{if(Ie.value.trim()){we.value=!0;try{const e=await v.post(`https://school.klgilc.com/api/notifications/${xe}/create_comment`,{comment_body:Ie.value},{headers:Fe(),timeout:1e4}),t={id:e.data.comment.id,comment_body:e.data.comment.comment_body,created_at:e.data.comment.created_at,user_id:e.data.comment.user_id,user_name:e.data.comment.user_name,avatar:e.data.comment.avatar||null,upvotes_count:0,downvotes_count:0,user_vote:null};$e.value.unshift(t),Ie.value="",Se.value&&(Se.value.comments_count+=1)}catch(e){console.error("Error adding comment:",e)}finally{we.value=!1}}},Je=async(e,t)=>{if(!ze.value){ze.value=!0;try{const a=$e.value.findIndex(t=>t.id===e);if(-1===a)return;const o=$e.value[a],l=o.user_vote;l===t?(o.user_vote=null,"upvote"===t&&o.upvotes_count--,"downvote"===t&&o.downvotes_count--):("upvote"===l&&o.upvotes_count--,"downvote"===l&&o.downvotes_count--,o.user_vote=t,"upvote"===t&&o.upvotes_count++,"downvote"===t&&o.downvotes_count++);const n=await v.post(`https://school.klgilc.com/api/comments/${e}/vote`,{vote_type:t},{headers:Fe(),timeout:1e4});$e.value[a]={...$e.value[a],upvotes_count:n.data.upvotes_count,downvotes_count:n.data.downvotes_count,user_vote:n.data.user_vote}}catch(a){console.error("Error voting on comment:",a),Ue(Ee.value)}finally{ze.value=!1}}},Me=async e=>{Ce.value=!0,Pe.value=!1;try{const t=await v.post(`https://school.klgilc.com/api/notifications/${xe}/reactions`,{reaction_type:e},{headers:Fe(),timeout:1e4});Se.value&&(Se.value.reaction_counts=t.data.reaction_counts,Se.value.user_reaction={reaction_type:e},Ae.value=t.data.reaction_id,console.log("Reaction added:",Ae.value))}catch(t){console.error("Error adding reaction:",t)}finally{Ce.value=!1}},We=async()=>{Ce.value=!0;try{const e=await v.delete(`https://school.klgilc.com/api/notifications/${xe}/delete_reaction`,{headers:Fe(),timeout:1e4});Se.value&&(Se.value.reaction_counts=e.data.reaction_counts,Ae.value=0,Se.value.user_reaction=null)}catch(e){console.error("Error removing reaction:",e)}finally{Ce.value=!1}},Fe=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${t}`}),He=e=>{if(console.error("Error fetching data:",e),v.isAxiosError(e)){var t;if(401===(null===(t=e.response)||void 0===t?void 0:t.status))return ye.replace("/"),void ie.show({text:"Session expired. Please login again",position:"top",duration:"long"});if("ECONNABORTED"===e.code)return void ie.show({text:"Request timeout. Please try again",position:"top"})}ie.show({text:"Failed to load data. Please try again later",position:"top"})};return i.setOverlaysWebView({overlay:!1}),i.setBackgroundColor({color:"#ffffff"}),i.setStyle({style:r.Light}),c(()=>{Le(),Re.value=localStorage.getItem("global_id")?Number(localStorage.getItem("global_id")):0}),(e,t)=>{const a=_("ion-buttons");return Z(),s(u(m),null,{default:d(()=>[g(u(b),null,{default:d(()=>[g(u(f),null,{default:d(()=>[g(a,{slot:"start"},{default:d(()=>[g(u(h))]),_:1}),g(u(y),null,{default:d(()=>t[3]||(t[3]=[x(" Notification ",-1)])),_:1,__:[3]})]),_:1})]),_:1}),g(u(K),{fullscreen:!0},{default:d(()=>[be.value?(Z(),k("div",re,[g(u(C),{name:"crescent",color:"primary"})])):ke.value?(Z(),k("div",ce,[g(u(z),{icon:u(S),color:"danger",size:"large"},null,8,["icon"]),g(u($),null,{default:d(()=>t[4]||(t[4]=[E("h3",null,"Error Loading Notification",-1),E("p",null,"Please try again later",-1)])),_:1,__:[4]}),g(u(N),{fill:"clear",onClick:Le},{default:d(()=>t[5]||(t[5]=[x("Retry",-1)])),_:1,__:[5]})])):Se.value?(Z(),k("div",se,[g(u(I),{class:"notification-card"},{default:d(()=>[g(u(j),null,{default:d(()=>[g(u(P),null,{default:d(()=>[x(A(Se.value.title),1)]),_:1}),g(u(R),null,{default:d(()=>[x(A(Ve(Se.value.created_at)),1)]),_:1})]),_:1}),g(u(T),null,{default:d(()=>[E("p",de,A(Se.value.body),1),E("div",ue,[(Z(!0),k(D,null,O(Se.value.reaction_counts,(e,t)=>(Z(),s(u(N),{key:t,fill:"clear",size:"small",onClick:e=>(async e=>{De.value===e?await We():await Me(e)})(t),color:De.value===t?"primary":"medium",disabled:Ce.value},{default:d(()=>[Ce.value&&De.value===t?(Z(),s(u(C),{key:0,name:"dots",slot:"start"})):(Z(),s(u(z),{key:1,icon:Oe(t),slot:"start"},null,8,["icon"])),x(" "+A(e),1)]),_:2},1032,["onClick","color","disabled"]))),128)),g(u(N),{fill:"clear",size:"small",onClick:t[0]||(t[0]=e=>Pe.value=!0),disabled:Ce.value},{default:d(()=>[g(u(z),{icon:u(V),slot:"icon-only"},null,8,["icon"])]),_:1},8,["disabled"])])]),_:1})]),_:1}),E("div",me,[g(u(L),null,{default:d(()=>[g(u(U),null,{default:d(()=>[g(u(B),null,{default:d(()=>[x("Comments ("+A(Se.value.comments_count)+")",1)]),_:1})]),_:1}),(Z(!0),k(D,null,O($e.value,e=>(Z(),s(u(M),{key:e.id,class:"comment-item"},{default:d(()=>[g(u(G),{slot:"start",style:{"margin-left":"20px"}},{default:d(()=>[E("img",{src:e.avatar||"/assets/img/default-avatar.svg"},null,8,ve)]),_:2},1024),g(u(B),null,{default:d(()=>[E("h3",null,A(e.user_name),1),E("p",null,A(e.comment_body),1),E("p",pe,A(Ve(e.created_at)),1)]),_:2},1024),E("div",ge,[g(u(N),{fill:"clear",size:"small",onClick:t=>Je(e.id,"upvote"),disabled:ze.value},{default:d(()=>[g(u(z),{icon:u(Y),color:"upvote"===e.user_vote?"primary":"medium"},null,8,["icon","color"]),E("span",fe,A(e.upvotes_count),1)]),_:2},1032,["onClick","disabled"]),g(u(N),{fill:"clear",size:"small",onClick:t=>Je(e.id,"downvote"),disabled:ze.value},{default:d(()=>[g(u(z),{icon:u(ee),color:"downvote"===e.user_vote?"danger":"medium"},null,8,["icon","color"]),E("span",_e,A(e.downvotes_count),1)]),_:2},1032,["onClick","disabled"])]),e.user_id===Re.value?(Z(),s(u(N),{key:0,fill:"clear",color:"danger",onClick:t=>(async e=>{je.value=e;try{await v.delete(`https://school.klgilc.com/api/comments/${e}`,{headers:Fe(),timeout:1e4}),$e.value=$e.value.filter(t=>t.id!==e),Se.value&&(Se.value.comments_count-=1)}catch(t){console.error("Error deleting comment:",t)}finally{je.value=null}})(e.id),disabled:je.value===e.id},{default:d(()=>[je.value===e.id?(Z(),s(u(C),{key:0,name:"dots",slot:"icon-only"})):(Z(),s(u(z),{key:1,icon:u(te),slot:"icon-only"},null,8,["icon"]))]),_:2},1032,["onClick","disabled"])):w("",!0)]),_:2},1024))),128)),g(u(q),{onIonInfinite:Be,threshold:"100px",disabled:!Ne.value},{default:d(()=>[g(u(J),{"loading-spinner":"bubbles","loading-text":"Loading more comments..."})]),_:1},8,["disabled"])]),_:1})]),E("div",he,[g(u(M),null,{default:d(()=>[g(u(W),{modelValue:Ie.value,"onUpdate:modelValue":t[1]||(t[1]=e=>Ie.value=e),placeholder:"Add a comment...","auto-grow":""},null,8,["modelValue"]),g(u(N),{slot:"end",fill:"clear",disabled:!Ie.value.trim(),onClick:qe},{default:d(()=>[we.value?(Z(),s(u(C),{key:0,slot:"start",name:"dots"})):w("",!0),g(u(z),{icon:u(F),color:"primary"},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})])])):w("",!0),g(u(H),{"is-open":Pe.value,onDidDismiss:t[2]||(t[2]=e=>Pe.value=!1)},{default:d(()=>[g(u(K),null,{default:d(()=>[g(u(Q),null,{default:d(()=>[g(u(X),null,{default:d(()=>[(Z(),k(D,null,O(Te,e=>g(u(ae),{key:e,size:"auto",onClick:t=>Me(e)},{default:d(()=>[g(u(N),{fill:"clear"},{default:d(()=>[g(u(z),{icon:Oe(e),size:"large"},null,8,["icon"])]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-8c639770"]]))}}});
