import{d as K,ao as U,r as _,o as W,O as Y,a as w,w as n,u as e,I as G,b as D,e as Q,f as X,g as t,h as Z,i as ee,P as te,l as ae,A as r,q as ne,k as l,s as m,a9 as C,a3 as c,t as d,x as E,C as L,n as i,as as se,at as oe,v as le,J as re,a2 as ce,m as ie,a4 as ue,S as de,T as _e,M as me,N as u,au as fe,a7 as pe,$ as N,K as ge,av as he,aw as ve,ax as ye,ay as ke,az as Ie,aA as we,aB as Ce,aC as be,aD as xe,aE as Oe,aF as Se,F as Ae,_ as Te}from"./index-CbFFUppU.js";import{T as b}from"./index-HY87JrIe.js";const Be={class:"header-section ion-padding"},De={class:"summary-cards"},Ee={class:"summary-content"},Le={class:"summary-content"},Ne={key:0,class:"loading-container"},Pe={key:1,class:"empty-state"},Re={key:2,class:"error-state"},Fe={key:3},Ve={class:"attendance-header"},Me={class:"attendance-details"},ze={class:"detail-row"},$e={class:"detail-row"},je={key:0,class:"detail-row"},qe={key:1,class:"detail-row"},He={slot:"end",class:"attendance-icon"},Je=K({__name:"AttendancePage",setup(Ke){const P=localStorage.getItem("parisklegg_token")||"",x=localStorage.getItem("parisklegg_user"),g=x?JSON.parse(x):null,R=(g==null?void 0:g.user_id)||0,F=U(),V=Q(),M=Number(F.params.id),h=_(""),v=_(!0),f=_(!1),O=_(!1),y=_([]),k=_(0),I=_(0),S=a=>{switch(a==null?void 0:a.toLowerCase()){case"present":return"var(--ion-color-success)";case"absent":return"var(--ion-color-danger)";case"late":return"var(--ion-color-warning)";case"sick":return"var(--ion-color-primary)";default:return"var(--ion-color-medium)"}},z=a=>{switch(a==null?void 0:a.toLowerCase()){case"present":return Ae;case"absent":return Se;case"late":return Oe;case"sick":return xe;default:return be}},$=a=>{switch(a==null?void 0:a.toLowerCase()){case"present":return"success";case"absent":return"danger";case"late":return"warning";case"sick":return"primary";default:return"medium"}},j=a=>new Date(a).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),A=async()=>{try{v.value=!0,f.value=!1,y.value=[],k.value=0,I.value=0;const s=(await D.get("https://klegg-app-whh7m.ondigitalocean.app/api/attendances",{headers:H(),timeout:2e4})).data.filter(o=>o.tutorship_id===M&&o.user_id===R);console.log("Filtered user attendance records:",s),s.length>0&&(O.value=!0,h.value=s[0].tutorship_name||"My Attendance",s.forEach(o=>{o.student_attendance.toLowerCase()==="present"?k.value++:o.student_attendance.toLowerCase()==="absent"&&I.value++}),y.value=s.sort((o,p)=>new Date(p.attendance_date||p.created_at).getTime()-new Date(o.attendance_date||o.created_at).getTime()))}catch(a){J(a),f.value=!0}finally{v.value=!1}},q=a=>{console.log("Reporting issue for record:",a)},H=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(P)}),J=a=>{var s;if(console.error("Error fetching data:",a),D.isAxiosError(a)){if(((s=a.response)==null?void 0:s.status)===401){V.replace("/"),b.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(a.code==="ECONNABORTED"){b.show({text:"Request timeout. Please try again",position:"top"});return}}b.show({text:"Failed to load data. Please try again later",position:"top"})},T=a=>{const s=a.matches;X(s)},B=()=>{const a=window.matchMedia("(prefers-color-scheme: dark)");return T(a),a.addEventListener("change",T),a};return W(()=>{B(),A()}),Y(async()=>{B()}),(a,s)=>(u(),w(e(G),null,{default:n(()=>[t(e(ne),null,{default:n(()=>[t(e(Z),null,{default:n(()=>[t(e(ee),{slot:"start"},{default:n(()=>[t(e(te),{"default-href":"/"})]),_:1}),t(e(ae),null,{default:n(()=>[...s[0]||(s[0]=[r("Attendance",-1)])]),_:1})]),_:1})]),_:1}),t(e(me),{fullscreen:!0},{default:n(()=>[l("div",Be,[h.value?(u(),w(e(c),{key:0,class:"title"},{default:n(()=>[r(d(h.value),1)]),_:1})):C("",!0),l("div",De,[t(e(E),{class:"summary-card present"},{default:n(()=>[t(e(L),null,{default:n(()=>[l("div",Ee,[t(e(i),{icon:e(se),class:"summary-icon"},null,8,["icon"]),l("div",null,[t(e(c),{class:"summary-count"},{default:n(()=>[r(d(k.value),1)]),_:1}),t(e(c),{class:"summary-label"},{default:n(()=>[...s[1]||(s[1]=[r("Present",-1)])]),_:1})])])]),_:1})]),_:1}),t(e(E),{class:"summary-card absent"},{default:n(()=>[t(e(L),null,{default:n(()=>[l("div",Le,[t(e(i),{icon:e(oe),class:"summary-icon"},null,8,["icon"]),l("div",null,[t(e(c),{class:"summary-count"},{default:n(()=>[r(d(I.value),1)]),_:1}),t(e(c),{class:"summary-label"},{default:n(()=>[...s[2]||(s[2]=[r("Absent",-1)])]),_:1})])])]),_:1})]),_:1})])]),v.value?(u(),m("div",Ne,[t(e(le),{name:"crescent",color:"primary"})])):!O.value&&!f.value?(u(),m("div",Pe,[t(e(i),{icon:e(re),color:"medium"},null,8,["icon"]),t(e(c),null,{default:n(()=>[...s[3]||(s[3]=[l("h3",null,"No Attendance Records",-1),l("p",null,"Your attendance will appear here when marked by your teacher",-1)])]),_:1})])):f.value?(u(),m("div",Re,[t(e(i),{icon:e(ce),color:"danger"},null,8,["icon"]),t(e(c),null,{default:n(()=>[...s[4]||(s[4]=[l("h3",null,"Error Loading Attendance",-1),l("p",null,"Please try again later",-1)])]),_:1}),t(e(ie),{fill:"clear",onClick:A},{default:n(()=>[...s[5]||(s[5]=[r("Retry",-1)])]),_:1})])):(u(),m("div",Fe,[t(e(ue),{lines:"none"},{default:n(()=>[(u(!0),m(de,null,_e(y.value,(o,p)=>(u(),w(e(fe),{key:p},{default:n(()=>[t(e(pe),{class:"attendance-item",detail:!1},{default:n(()=>[l("div",{slot:"start",class:"status-indicator",style:N({backgroundColor:S(o.student_attendance)})},null,4),t(e(ge),{class:"attendance-content"},{default:n(()=>[l("div",Ve,[t(e(c),{class:"attendance-status",style:N({color:S(o.student_attendance)})},{default:n(()=>[r(d(o.student_attendance),1)]),_:2},1032,["style"]),t(e(c),{class:"attendance-date bal-text-color"},{default:n(()=>[r(d(j(o.attendance_date||o.created_at)),1)]),_:2},1024)]),l("div",Me,[l("div",ze,[t(e(i),{icon:e(he)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:n(()=>[r(d(o.student_name),1)]),_:2},1024)]),l("div",$e,[t(e(i),{icon:e(ve)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:n(()=>[r(d(o.teacher_name),1)]),_:2},1024)]),o.attendance_code?(u(),m("div",je,[t(e(i),{icon:e(ye)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:n(()=>[r("Code: "+d(o.attendance_code),1)]),_:2},1024)])):C("",!0),o.remark?(u(),m("div",qe,[t(e(i),{icon:e(ke)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:n(()=>[r(d(o.remark),1)]),_:2},1024)])):C("",!0)])]),_:2},1024),l("div",He,[t(e(i),{icon:z(o.student_attendance),color:$(o.student_attendance)},null,8,["icon","color"])])]),_:2},1024),t(e(Ie),{side:"end"},{default:n(()=>[t(e(we),{color:"danger",onClick:Ue=>q(o)},{default:n(()=>[t(e(i),{slot:"icon-only",icon:e(Ce)},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1}))}}),Ge=Te(Je,[["__scopeId","data-v-cf16e0cb"]]);export{Ge as default};
