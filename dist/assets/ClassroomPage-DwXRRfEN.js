import{d as ie,ao as ue,r as p,o as ce,O as de,ap as me,a as D,w as o,u as n,I as fe,b as R,e as ge,f as pe,g as a,h as he,i as we,P as Te,l as _e,A as u,q as De,k as w,s as c,a9 as C,a3 as f,t as d,v as Ce,n as v,J as ve,a2 as Ie,m as z,S as ke,T as Je,M as be,N as r,x as Se,W as Me,y as Ee,z as Be,aq as xe,C as Pe,a7 as Ke,G as I,K as Ne,ar as $e,_ as Oe}from"./index-CbFFUppU.js";import{T}from"./index-HY87JrIe.js";const ye={class:"header-section"},je={key:0,class:"loading-container"},Ae={key:1,class:"empty-state"},Fe={key:2,class:"error-state"},Le={key:3,class:"timetable-container"},Re={key:0,class:"join-section"},ze={key:0,class:"countdown"},Ve={key:1,class:"status-message"},We={key:1,class:"not-today-message"},He=ie({__name:"ClassroomPage",setup(qe){const V=localStorage.getItem("parisklegg_token")||"",E=localStorage.getItem("parisklegg_user");E&&JSON.parse(E);const W=ue(),H=ge(),B=Number(W.params.id),h=p(""),x=p(""),k=p(!0),J=p(!1),b=p(!1),_=p([]);let g=null;const q=()=>{const e=new Date,s=e.getDay()||7,t=new Date(e);t.setDate(e.getDate()-s+1);const l=new Date(t);l.setDate(t.getDate()+6);const i={month:"short",day:"numeric"};return"".concat(t.toLocaleDateString(void 0,i)," - ").concat(l.toLocaleDateString(void 0,i))},G=e=>e.classEnded?"Join Ended":e.classInProgress?"Join Now":(e.canJoin,"Join Soon"),U=e=>e.classEnded?"medium":e.classInProgress?"success":e.canJoin?"primary":"medium",Y=e=>e.classEnded?"outline":e.classInProgress||e.canJoin?"solid":"outline",Q=e=>e.classEnded?I:e.classInProgress?$e:e.canJoin?I:I,X=(e,s)=>!!e&&e.trim()!==""&&!!s&&s.trim()!=="",P=e=>{const[s,t]=e.split(":").map(Number),l=new Date;return l.setHours(s,t,0,0),l},K=(e,s)=>{const t=new Date;return t>=e&&t<s},N=e=>new Date>=e,$=e=>{const s=new Date,t=new Date(e.getTime()-10*60*1e3);if(s<t){const l=t.getTime()-s.getTime(),i=Math.floor(l/(1e3*60*60)),m=Math.floor(l%(1e3*60*60)/(1e3*60));return i>0?"".concat(i,"h ").concat(m,"m"):"".concat(m,"m")}return""},Z=()=>{_.value.forEach(e=>{if(e.isToday&&e.startDateTime&&e.endDateTime){const s=new Date,t=new Date(e.startDateTime.getTime()-10*60*1e3);e.canJoin=!1,e.statusMessage="",e.statusColor="medium",s<t?(e.countdown=$(e.startDateTime),e.statusMessage="Join available at ".concat(O(t))):s>=t&&s<e.startDateTime?(e.canJoin=!0,e.countdown="",e.statusMessage="Join now to enter class",e.statusColor="success"):K(e.startDateTime,e.endDateTime)?(e.canJoin=!0,e.countdown="",e.statusMessage="Class in progress - Join now",e.statusColor="warning"):N(e.endDateTime)&&(e.countdown="",e.statusMessage="Class has ended",e.statusColor="danger")}})},O=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),y=async()=>{try{k.value=!0,J.value=!1;const e=await R.post("https://klegg-app-whh7m.ondigitalocean.app/api/timetable",{tutorship_id:B},{headers:ae(),timeout:2e4});console.log("Timetable response:",e.data),ee(e.data)}catch(e){oe(e),J.value=!0}finally{k.value=!1}},ee=e=>{const s=[{name:"Monday",dayKey:"monday"},{name:"Tuesday",dayKey:"tuesday"},{name:"Wednesday",dayKey:"wednesday"},{name:"Thursday",dayKey:"thursday"},{name:"Friday",dayKey:"friday"},{name:"Saturday",dayKey:"saturday"},{name:"Sunday",dayKey:"sunday"}],t=new Date().getDay(),l=s[t===0?6:t-1].dayKey;_.value=[],b.value=!1,e.forEach(i=>{i.tutorship_id===B&&(h.value=i.tutorship_name||"My Timetable",s.forEach(m=>{const S=i["".concat(m.dayKey,"_start")],M=i["".concat(m.dayKey,"_end")];if(X(S,M)){b.value=!0;const re=P(S),le=P(M),F=m.dayKey===l,L={name:m.name,dayKey:m.dayKey,startTime:S,endTime:M,isToday:F,canJoin:!1,classInProgress:!1,classEnded:!1,startDateTime:re,endDateTime:le};F&&te(L),_.value.push(L)}}))}),se()},te=e=>{if(!e.startDateTime||!e.endDateTime)return;const s=new Date,t=new Date(e.startDateTime.getTime()-10*60*1e3);e.canJoin=!1,e.classInProgress=!1,e.classEnded=!1,e.countdown="",e.statusMessage="",e.statusColor="medium",s<t?(e.countdown=$(e.startDateTime),e.statusMessage="Join available at ".concat(O(t)),e.statusColor="medium"):s>=t&&s<e.startDateTime?(e.canJoin=!0,e.statusMessage="Class starting soon - Join now",e.statusColor="success"):K(e.startDateTime,e.endDateTime)?(e.canJoin=!0,e.classInProgress=!0,e.statusMessage="Class in progress",e.statusColor="warning"):N(e.endDateTime)&&(e.classEnded=!0,e.statusMessage="Class has ended",e.statusColor="danger")},se=()=>{g&&clearInterval(g),g=window.setInterval(()=>{Z()},6e4)},ne=e=>{e.canJoin&&(T.show({text:"Joining ".concat(h.value," class..."),position:"top",duration:"short"}),setTimeout(()=>{T.show({text:"Successfully joined ".concat(h.value," class!"),position:"top",duration:"short"})},1e3))},ae=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(V)}),oe=e=>{var s;if(console.error("Error fetching data:",e),R.isAxiosError(e)){if(((s=e.response)==null?void 0:s.status)===401){H.replace("/"),T.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(e.code==="ECONNABORTED"){T.show({text:"Request timeout. Please try again",position:"top"});return}}T.show({text:"Failed to load data. Please try again later",position:"top"})},j=e=>{const s=e.matches;pe(s)},A=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");return j(e),e.addEventListener("change",j),e};return ce(()=>{A(),x.value=q(),y()}),de(async()=>{A()}),me(()=>{g&&(clearInterval(g),g=null)}),(e,s)=>(r(),D(n(fe),null,{default:o(()=>[a(n(De),null,{default:o(()=>[a(n(he),null,{default:o(()=>[a(n(we),{slot:"start"},{default:o(()=>[a(n(Te),{"default-href":"/"})]),_:1}),a(n(_e),null,{default:o(()=>[...s[0]||(s[0]=[u("Classroom",-1)])]),_:1})]),_:1})]),_:1}),a(n(be),{class:"ion-padding",fullscreen:!0},{default:o(()=>[w("div",ye,[h.value?(r(),D(n(f),{key:0,class:"title"},{default:o(()=>[u(d(h.value),1)]),_:1})):C("",!0),a(n(f),{class:"subtitle"},{default:o(()=>[u(d(x.value),1)]),_:1})]),k.value?(r(),c("div",je,[a(n(Ce),{name:"crescent",color:"primary"})])):b.value?J.value?(r(),c("div",Fe,[a(n(v),{icon:n(Ie),color:"danger",size:"large"},null,8,["icon"]),a(n(f),null,{default:o(()=>[...s[2]||(s[2]=[w("h3",null,"Failed to load timetable",-1),w("p",null,"Please try again later",-1)])]),_:1}),a(n(z),{onClick:y,fill:"clear"},{default:o(()=>[...s[3]||(s[3]=[u("Retry",-1)])]),_:1})])):(r(),c("div",Le,[(r(!0),c(ke,null,Je(_.value,(t,l)=>(r(),D(n(Se),{key:l,class:Me(["day-card",{"today-card":t.isToday}])},{default:o(()=>[a(n(Ee),null,{default:o(()=>[a(n(Be),{class:"day-title"},{default:o(()=>[u(d(t.name)+" ",1),t.isToday?(r(),D(n(xe),{key:0,color:"success"},{default:o(()=>[...s[4]||(s[4]=[u("Today",-1)])]),_:1})):C("",!0)]),_:2},1024)]),_:2},1024),a(n(Pe),{class:"time-content"},{default:o(()=>[a(n(Ke),{lines:"none"},{default:o(()=>[a(n(v),{slot:"start",icon:n(I),color:"primary"},null,8,["icon"]),a(n(Ne),null,{default:o(()=>[u(d(t.startTime)+" - "+d(t.endTime),1)]),_:2},1024)]),_:2},1024),t.isToday?(r(),c("div",Re,[a(n(z),{class:"join-button",disabled:!t.canJoin&&!t.classEnded,fill:Y(t),color:U(t),onClick:i=>ne(t),expand:"block"},{default:o(()=>[a(n(v),{slot:"start",icon:Q(t)},null,8,["icon"]),u(" "+d(G(t)),1)]),_:2},1032,["disabled","fill","color","onClick"]),t.countdown&&!t.canJoin&&!t.classInProgress?(r(),c("div",ze,[a(n(f),{color:"medium"},{default:o(()=>[u(" Starts in "+d(t.countdown),1)]),_:2},1024)])):C("",!0),t.statusMessage?(r(),c("div",Ve,[a(n(f),{color:t.statusColor},{default:o(()=>[u(d(t.statusMessage),1)]),_:2},1032,["color"])])):C("",!0)])):(r(),c("div",We,[a(n(f),{color:"medium"},{default:o(()=>[u(" Join link will be available on "+d(t.name),1)]),_:2},1024)]))]),_:2},1024)]),_:2},1032,["class"]))),128))])):(r(),c("div",Ae,[a(n(v),{icon:n(ve),size:"large"},null,8,["icon"]),a(n(f),null,{default:o(()=>[...s[1]||(s[1]=[w("h3",null,"No Classes Scheduled",-1),w("p",null,"Your timetable will appear here when classes are scheduled",-1)])]),_:1})]))]),_:1})]),_:1}))}}),Ye=Oe(He,[["__scopeId","data-v-7192db58"]]);export{Ye as default};
