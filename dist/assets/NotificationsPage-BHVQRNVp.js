import{d as q,r as u,P as J,o as W,a as m,w as s,u as a,I as Y,b as T,e as G,f as K,g as o,h as Q,m as X,B as h,s as Z,v as c,l as i,x as tt,p as _,a2 as et,a3 as E,n as at,F as ot,a4 as nt,S as P,R as B,a5 as st,a6 as lt,N as it,L as rt,O as l,a7 as ct,k as ut,a8 as dt,a9 as D,aa as L,t as f,ab as ft,ac as pt,ad as gt,ae as A,_ as mt}from"./index-D8EdY7VT.js";import{T as N}from"./index-DSbRV_FN.js";const ht={key:0,class:"loading-container"},_t={key:1,class:"error-state"},vt={key:2,class:"empty-state"},yt={class:"preview-text"},It={key:0,class:"reactions-row"},kt={class:"notification-meta"},Nt={class:"date"},bt={key:0,class:"comments-count"},wt=q({__name:"NotificationsPage",setup(St){const b=localStorage.getItem("parisklegg_token")||"",w=localStorage.getItem("parisklegg_user");w&&JSON.parse(w);const R=e=>({like:A,heart:gt,"thumbs-up":pt})[e]||A,S=G(),p=u(!0),g=u(!1),v=u(!1),r=u([]),y=u(1),I=u(!0),d=async(e=1)=>{try{if(e===1?(p.value=!0,r.value=[]):g.value=!0,v.value=!1,!b)throw new Error("No authentication token found");const t=await T.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications",{headers:z(),timeout:1e4,params:{page:e}});e===1?r.value=t.data.data:r.value=[...r.value,...t.data.data],y.value=e,I.value=!!t.data.next_page_url,console.log("Notifications fetched successfully:",r.value)}catch(t){$(t),v.value=!0}finally{p.value=!1,g.value=!1}},H=async e=>{await d(y.value+1),e.target.complete()},V=e=>{const t=e.target;if(!t)return;const k=t.scrollHeight;t.scrollTop+t.clientHeight>k*.8&&I.value&&!g.value&&d(y.value+1)},F=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),M=(e,t)=>e.length<=t?e:e.substring(0,t)+"...",j=e=>{S.push("/notifications/".concat(e))};J(async()=>{await d()});const z=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(b)}),$=e=>{var t;if(console.error("Error fetching data:",e),T.isAxiosError(e)){if(((t=e.response)==null?void 0:t.status)===401){S.replace("/"),N.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(e.code==="ECONNABORTED"){N.show({text:"Request timeout. Please try again",position:"top"});return}}N.show({text:"Failed to load data. Please try again later",position:"top"})},x=e=>{const t=e.matches;K(t)},U=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");return x(e),e.addEventListener("change",x),e};return W(()=>{U(),d()}),(e,t)=>{const k=rt("ion-chip");return l(),m(a(Y),null,{default:s(()=>[o(a(Z),null,{default:s(()=>[o(a(Q),null,{default:s(()=>[o(a(X),null,{default:s(()=>[...t[2]||(t[2]=[h("Notifications",-1)])]),_:1})]),_:1})]),_:1}),o(a(it),{fullscreen:!0,onIonScroll:t[1]||(t[1]=n=>V(n))},{default:s(()=>[p.value&&!g.value?(l(),c("div",ht,[o(a(tt),{name:"crescent",color:"primary"}),t[3]||(t[3]=i("p",null,"Loading notifications...",-1))])):v.value?(l(),c("div",_t,[o(a(_),{icon:a(et),color:"danger",size:"large"},null,8,["icon"]),o(a(E),null,{default:s(()=>[...t[4]||(t[4]=[i("h3",null,"Error Loading Notifications",-1),i("p",null,"Please try again later",-1)])]),_:1}),o(a(at),{fill:"clear",onClick:d},{default:s(()=>[...t[5]||(t[5]=[h("Retry",-1)])]),_:1})])):r.value.length===0&&!p.value?(l(),c("div",vt,[o(a(_),{icon:a(ot),color:"medium",size:"large"},null,8,["icon"]),o(a(E),null,{default:s(()=>[...t[6]||(t[6]=[i("h3",null,"No Notifications",-1),i("p",null,"You don't have any notifications yet",-1)])]),_:1})])):(l(),m(a(nt),{key:3},{default:s(()=>[(l(!0),c(B,null,P(r.value,n=>(l(),m(a(ct),{key:n.id,onClick:C=>j(n.id),class:"notification-item"},{default:s(()=>[o(a(ut),{slot:"start",class:"notification-avatar"},{default:s(()=>[...t[7]||(t[7]=[i("img",{src:dt,alt:"School Logo"},null,-1)])]),_:1}),o(a(D),null,{default:s(()=>[i("h2",null,f(n.title),1),i("p",yt,f(M(n.body,60)),1),n.reaction_counts&&Object.keys(n.reaction_counts).length?(l(),c("div",It,[(l(!0),c(B,null,P(n.reaction_counts,(C,O)=>(l(),m(k,{key:O,color:"light",class:"reaction-chip"},{default:s(()=>[o(a(_),{icon:R(O)},null,8,["icon"]),o(a(D),null,{default:s(()=>[h(f(C),1)]),_:2},1024)]),_:2},1024))),128))])):L("",!0),i("div",kt,[i("span",Nt,f(F(n.created_at)),1),n.comments_count?(l(),c("span",bt,[o(a(_),{icon:a(ft)},null,8,["icon"]),h(" "+f(n.comments_count),1)])):L("",!0)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})),o(a(st),{onIonInfinite:t[0]||(t[0]=n=>H(n)),threshold:"100px",disabled:!I.value},{default:s(()=>[o(a(lt),{"loading-spinner":"bubbles","loading-text":"Loading more notifications..."})]),_:1},8,["disabled"])]),_:1})]),_:1})}}}),Ot=mt(wt,[["__scopeId","data-v-6b08a1a0"]]);export{Ot as default};
