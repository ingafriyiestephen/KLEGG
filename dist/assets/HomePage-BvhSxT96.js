import{d as Q,r as I,c as h,o as U,a as W,w as a,u as t,I as X,b as C,e as Z,f as tt,g as e,h as et,i as H,j as nt,k as s,l as at,t as c,m as d,n as i,p as ot,q as st,s as u,v as lt,x as T,y as D,z as b,A as l,B as P,C as N,D as q,E as it,F as rt,G as ct,H as ut,J as dt,K as A,L as ft,M as pt,N as r,_ as gt}from"./index-CbFFUppU.js";import{T as f}from"./index-HY87JrIe.js";const _t=["src"],ht={class:"greeting"},mt={class:"student-name"},vt={key:0,class:"loading-container"},kt={key:1},yt={key:0,class:"notification-content"},wt={key:1,class:"empty-state"},It={key:0,class:"attendance-content"},Ct={key:1,class:"empty-state"},Tt={class:"quick-actions-grid"},Dt={class:"action-icon"},bt={class:"action-icon"},Nt={class:"action-icon"},At=Q({__name:"HomePage",setup(St){const M=localStorage.getItem("parisklegg_token")||"",S=localStorage.getItem("parisklegg_user"),m=S?JSON.parse(S):null,z=(m==null?void 0:m.fullname)||"",p=Z(),g=I(!0),v=I([]),k=I([]),G=h(()=>{const o=new Date().getHours();return o<12?"Good Morning":o<18?"Good Afternoon":"Good Evening"}),y=h(()=>v.value.length>0?v.value[0]:null),w=h(()=>k.value.length>0?k.value[0]:null),L=h(()=>"/assets/img/login-logo.png"),x=o=>{const n=new Date(o),K=Math.abs(new Date().getTime()-n.getTime()),_=Math.floor(K/(1e3*60*60*24));return _===0?"Today":_===1?"Yesterday":_<7?"".concat(_," days ago"):n.toLocaleDateString()},V=(o,n)=>o?o.length>n?o.substring(0,n)+"...":o:"",j=()=>p.push("/tutorships"),O=()=>p.push("/notifications"),F=()=>p.push("/settings"),J=async()=>{g.value=!0;try{await B(),await f.show({text:"Data refreshed",position:"top"})}catch(o){console.error("Refresh error:",o),await f.show({text:"Refresh failed",position:"top"})}finally{g.value=!1}},B=async()=>{try{const[o,n]=await Promise.all([C.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications",{headers:E()}),C.get("https://klegg-app-whh7m.ondigitalocean.app/api/attendances",{headers:E()})]);v.value=o.data,k.value=n.data}catch(o){Y(o)}},E=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(M)}),Y=o=>{var n;if(console.error("Error fetching data:",o),C.isAxiosError(o)){if(((n=o.response)==null?void 0:n.status)===401){p.replace("/"),f.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(o.code==="ECONNABORTED"){f.show({text:"Request timeout. Please try again",position:"top"});return}}f.show({text:"Failed to load data. Please try again later",position:"top"})},R=o=>{const n=o.matches;tt(n)},$=()=>{const o=window.matchMedia("(prefers-color-scheme: dark)");return R(o),o.addEventListener("change",R),o};return U(async()=>{try{$(),await B()}catch(o){console.error("Initialization error:",o)}finally{g.value=!1}}),(o,n)=>(r(),W(t(X),null,{default:a(()=>[e(t(st),{class:"ion-no-border"},{default:a(()=>[e(t(et),null,{default:a(()=>[e(t(H),{slot:"start"},{default:a(()=>[e(t(nt),{class:"toolbar-avatar"},{default:a(()=>[s("img",{src:L.value,alt:"Student"},null,8,_t)]),_:1})]),_:1}),e(t(at),{class:"toolbar-title"},{default:a(()=>[s("div",ht,c(G.value),1),s("div",mt,c(t(z)),1)]),_:1}),e(t(H),{slot:"end"},{default:a(()=>[e(t(d),{onClick:J,fill:"clear"},{default:a(()=>[e(t(i),{icon:t(ot),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),e(t(pt),{fullscreen:!0},{default:a(()=>[g.value?(r(),u("div",vt,[e(t(lt),{name:"crescent"}),n[0]||(n[0]=s("p",null,"Loading your data...",-1))])):(r(),u("div",kt,[e(t(T),{class:"content-card"},{default:a(()=>[e(t(D),null,{default:a(()=>[e(t(b),null,{default:a(()=>[e(t(i),{icon:t(P)},null,8,["icon"]),n[1]||(n[1]=l(" Recent Updates ",-1))]),_:1})]),_:1}),e(t(N),null,{default:a(()=>[y.value?(r(),u("div",yt,[s("p",null,c(V(y.value.notification_body,100)),1),e(t(q),null,{default:a(()=>[l(c(x(y.value.created_at)),1)]),_:1})])):(r(),u("div",wt,[e(t(i),{icon:t(it)},null,8,["icon"]),n[2]||(n[2]=s("p",null,"No recent updates",-1))])),e(t(d),{expand:"block",fill:"clear",size:"small",onClick:O,class:"view-all-button"},{default:a(()=>[...n[3]||(n[3]=[l(" View All Notifications ",-1)])]),_:1})]),_:1})]),_:1}),e(t(T),{class:"content-card"},{default:a(()=>[e(t(D),null,{default:a(()=>[e(t(b),null,{default:a(()=>[e(t(i),{icon:t(rt)},null,8,["icon"]),n[4]||(n[4]=l(" Recent Attendance ",-1))]),_:1})]),_:1}),e(t(N),null,{default:a(()=>[w.value?(r(),u("div",It,[s("p",null,[n[5]||(n[5]=l(" You were marked ",-1)),s("strong",null,c(w.value.student_attendance),1)]),e(t(q),null,{default:a(()=>[l(c(x(w.value.created_at)),1)]),_:1})])):(r(),u("div",Ct,[e(t(i),{icon:t(ct)},null,8,["icon"]),n[6]||(n[6]=s("p",null,"No attendance records yet",-1))]))]),_:1})]),_:1}),e(t(T),{class:"content-card"},{default:a(()=>[e(t(D),null,{default:a(()=>[e(t(b),null,{default:a(()=>[e(t(i),{icon:t(ut)},null,8,["icon"]),n[7]||(n[7]=l(" Quick Actions ",-1))]),_:1})]),_:1}),e(t(N),null,{default:a(()=>[s("div",Tt,[e(t(d),{fill:"clear",class:"quick-action-button",onClick:j},{default:a(()=>[s("div",Dt,[e(t(i),{icon:t(dt)},null,8,["icon"])]),e(t(A),null,{default:a(()=>[...n[8]||(n[8]=[l("Classes",-1)])]),_:1})]),_:1}),e(t(d),{fill:"clear",class:"quick-action-button",onClick:O},{default:a(()=>[s("div",bt,[e(t(i),{icon:t(P)},null,8,["icon"])]),e(t(A),null,{default:a(()=>[...n[9]||(n[9]=[l("Notifications",-1)])]),_:1})]),_:1}),e(t(d),{fill:"clear",class:"quick-action-button",onClick:F},{default:a(()=>[s("div",Nt,[e(t(i),{icon:t(ft)},null,8,["icon"])]),e(t(A),null,{default:a(()=>[...n[10]||(n[10]=[l("Settings",-1)])]),_:1})]),_:1})])]),_:1})]),_:1})]))]),_:1})]),_:1}))}}),Et=gt(At,[["__scopeId","data-v-b77143f3"]]);export{Et as default};
