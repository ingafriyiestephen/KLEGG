import{d as J,ap as K,r as _,o as U,P as W,a as w,w as n,u as e,I as Y,b as T,e as Z,f as Q,g as t,h as X,j as ee,ar as te,m as ae,B as r,s as ne,l,v as m,aa as C,a3 as c,t as d,y as E,D as L,p as i,au as se,av as oe,x as le,K as re,a2 as ce,n as ie,a4 as ue,R as de,S as _e,N as me,O as u,aw as pe,a7 as fe,Z as N,a9 as ge,ax as he,ay as ve,az as ye,aA as ke,aB as Ie,aC as we,aD as Ce,aE as be,aF as xe,aG as Oe,aH as Se,G as Ae,_ as Be}from"./index-KRMmF5hz.js";import{T as b}from"./index-DxolAIpy.js";const De={class:"header-section ion-padding"},Te={class:"summary-cards"},Ee={class:"summary-content"},Le={class:"summary-content"},Ne={key:0,class:"loading-container"},Re={key:1,class:"empty-state"},Pe={key:2,class:"error-state"},Fe={key:3},Ve={class:"attendance-header"},je={class:"attendance-details"},ze={class:"detail-row"},He={class:"detail-row"},Me={key:0,class:"detail-row"},Ge={key:1,class:"detail-row"},$e={slot:"end",class:"attendance-icon"},qe=J({__name:"AttendancePage",setup(Je){const R=localStorage.getItem("parisklegg_token")||"",x=localStorage.getItem("parisklegg_user"),g=x?JSON.parse(x):null,P=(g==null?void 0:g.user_id)||0,F=K(),V=Z(),j=Number(F.params.id),h=_(""),v=_(!0),p=_(!1),O=_(!1),y=_([]),k=_(0),I=_(0),S=a=>{switch(a==null?void 0:a.toLowerCase()){case"present":return"var(--ion-color-success)";case"absent":return"var(--ion-color-danger)";case"late":return"var(--ion-color-warning)";case"sick":return"var(--ion-color-primary)";default:return"var(--ion-color-medium)"}},z=a=>{switch(a==null?void 0:a.toLowerCase()){case"present":return Ae;case"absent":return Se;case"late":return Oe;case"sick":return xe;default:return be}},H=a=>{switch(a==null?void 0:a.toLowerCase()){case"present":return"success";case"absent":return"danger";case"late":return"warning";case"sick":return"primary";default:return"medium"}},M=a=>new Date(a).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),A=async()=>{try{v.value=!0,p.value=!1,y.value=[],k.value=0,I.value=0;const s=(await T.get("https://klegg-app-whh7m.ondigitalocean.app/api/attendances",{headers:$(),timeout:2e4})).data.filter(o=>o.tutorship_id===j&&o.user_id===P);console.log("Filtered user attendance records:",s),s.length>0&&(O.value=!0,h.value=s[0].tutorship_name||"My Attendance",s.forEach(o=>{o.student_attendance.toLowerCase()==="present"?k.value++:o.student_attendance.toLowerCase()==="absent"&&I.value++}),y.value=s.sort((o,f)=>new Date(f.attendance_date||f.created_at).getTime()-new Date(o.attendance_date||o.created_at).getTime()))}catch(a){q(a),p.value=!0}finally{v.value=!1}},G=a=>{console.log("Reporting issue for record:",a)},$=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(R)}),q=a=>{var s;if(console.error("Error fetching data:",a),T.isAxiosError(a)){if(((s=a.response)==null?void 0:s.status)===401){V.replace("/"),b.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(a.code==="ECONNABORTED"){b.show({text:"Request timeout. Please try again",position:"top"});return}}b.show({text:"Failed to load data. Please try again later",position:"top"})},B=a=>{const s=a.matches;Q(s)},D=()=>{const a=window.matchMedia("(prefers-color-scheme: dark)");return B(a),a.addEventListener("change",B),a};return U(()=>{D(),A()}),W(async()=>{D()}),(a,s)=>(u(),w(e(Y),null,{default:n(()=>[t(e(ne),null,{default:n(()=>[t(e(X),null,{default:n(()=>[t(e(ee),{slot:"start"},{default:n(()=>[t(e(te),{"default-href":"/"})]),_:1}),t(e(ae),null,{default:n(()=>[...s[0]||(s[0]=[r("Attendance",-1)])]),_:1})]),_:1})]),_:1}),t(e(me),{fullscreen:!0},{default:n(()=>[l("div",De,[h.value?(u(),w(e(c),{key:0,class:"title"},{default:n(()=>[r(d(h.value),1)]),_:1})):C("",!0),l("div",Te,[t(e(E),{class:"summary-card present"},{default:n(()=>[t(e(L),null,{default:n(()=>[l("div",Ee,[t(e(i),{icon:e(se),class:"summary-icon"},null,8,["icon"]),l("div",null,[t(e(c),{class:"summary-count"},{default:n(()=>[r(d(k.value),1)]),_:1}),t(e(c),{class:"summary-label"},{default:n(()=>[...s[1]||(s[1]=[r("Present",-1)])]),_:1})])])]),_:1})]),_:1}),t(e(E),{class:"summary-card absent"},{default:n(()=>[t(e(L),null,{default:n(()=>[l("div",Le,[t(e(i),{icon:e(oe),class:"summary-icon"},null,8,["icon"]),l("div",null,[t(e(c),{class:"summary-count"},{default:n(()=>[r(d(I.value),1)]),_:1}),t(e(c),{class:"summary-label"},{default:n(()=>[...s[2]||(s[2]=[r("Absent",-1)])]),_:1})])])]),_:1})]),_:1})])]),v.value?(u(),m("div",Ne,[t(e(le),{name:"crescent",color:"primary"})])):!O.value&&!p.value?(u(),m("div",Re,[t(e(i),{icon:e(re),color:"medium"},null,8,["icon"]),t(e(c),null,{default:n(()=>[...s[3]||(s[3]=[l("h3",null,"No Attendance Records",-1),l("p",null,"Your attendance will appear here when marked by your teacher",-1)])]),_:1})])):p.value?(u(),m("div",Pe,[t(e(i),{icon:e(ce),color:"danger"},null,8,["icon"]),t(e(c),null,{default:n(()=>[...s[4]||(s[4]=[l("h3",null,"Error Loading Attendance",-1),l("p",null,"Please try again later",-1)])]),_:1}),t(e(ie),{fill:"clear",onClick:A},{default:n(()=>[...s[5]||(s[5]=[r("Retry",-1)])]),_:1})])):(u(),m("div",Fe,[t(e(ue),{lines:"none"},{default:n(()=>[(u(!0),m(de,null,_e(y.value,(o,f)=>(u(),w(e(pe),{key:f},{default:n(()=>[t(e(fe),{class:"attendance-item",detail:!1},{default:n(()=>[l("div",{slot:"start",class:"status-indicator",style:N({backgroundColor:S(o.student_attendance)})},null,4),t(e(ge),{class:"attendance-content"},{default:n(()=>[l("div",Ve,[t(e(c),{class:"attendance-status",style:N({color:S(o.student_attendance)})},{default:n(()=>[r(d(o.student_attendance),1)]),_:2},1032,["style"]),t(e(c),{class:"attendance-date bal-text-color"},{default:n(()=>[r(d(M(o.attendance_date||o.created_at)),1)]),_:2},1024)]),l("div",je,[l("div",ze,[t(e(i),{icon:e(he)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:n(()=>[r(d(o.student_name),1)]),_:2},1024)]),l("div",He,[t(e(i),{icon:e(ve)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:n(()=>[r(d(o.teacher_name),1)]),_:2},1024)]),o.attendance_code?(u(),m("div",Me,[t(e(i),{icon:e(ye)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:n(()=>[r("Code: "+d(o.attendance_code),1)]),_:2},1024)])):C("",!0),o.remark?(u(),m("div",Ge,[t(e(i),{icon:e(ke)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:n(()=>[r(d(o.remark),1)]),_:2},1024)])):C("",!0)])]),_:2},1024),l("div",$e,[t(e(i),{icon:z(o.student_attendance),color:H(o.student_attendance)},null,8,["icon","color"])])]),_:2},1024),t(e(Ie),{side:"end"},{default:n(()=>[t(e(we),{color:"danger",onClick:Ke=>G(o)},{default:n(()=>[t(e(i),{slot:"icon-only",icon:e(Ce)},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1}))}}),Ye=Be(qe,[["__scopeId","data-v-cf16e0cb"]]);export{Ye as default};
