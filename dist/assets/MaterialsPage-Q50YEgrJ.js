import{d as ve,aq as ye,r as _,c as we,i as H,o as ke,P as Ce,a as k,w as n,u as a,I as Fe,b as J,e as Ie,f as xe,g as s,h as Te,j as Oe,as as Se,m as $e,B as i,s as be,l as c,v as g,aa as C,a3 as u,t as m,y as q,D as Z,p,aB as Q,$ as F,x as Ee,n as I,a2 as De,a4 as Me,R as W,S as X,N as Be,O as d,ax as Ne,a7 as Pe,Z as Y,a9 as Le,at as Ue,aP as G,T as Ae,H as Re,aJ as K,aC as je,aD as ze,ak as Ve,aQ as ee,aR as He,aS as Je,au as qe,aT as Ze,aU as Qe,_ as We}from"./index-D8EdY7VT.js";import{T as h}from"./index-DSbRV_FN.js";const Xe={class:"header-section ion-padding"},Ye={class:"summary-cards"},Ge={class:"summary-content"},Ke={class:"summary-content"},et={key:0,class:"loading-container"},tt={key:1,class:"empty-state"},at={key:2,class:"error-state"},st={key:3},ot={class:"material-header"},nt={class:"material-meta theme-text-eight"},rt={key:0,class:"material-description"},lt={key:1,class:"files-container"},it={class:"files-list"},ct=["onClick"],ut={class:"file-info"},dt={class:"material-footer"},x="https://storage.draugustinaosabutey.com/*/admin/file/download/",pt=ve({__name:"MaterialsPage",setup(ft){const te=localStorage.getItem("parisklegg_token")||"",B=localStorage.getItem("parisklegg_user"),T=B?JSON.parse(B):null;T!=null&&T.user_id;const ae=ye(),se=Ie(),N=Number(ae.params.id),O=_(""),S=_(!0),y=_(!1),$=_(!1),v=_([]),b=_(0),E=_(0),D=t=>{if(!t)return"";const e=t.split(".");return e.length>1?e[e.length-1].toLowerCase():""},oe=t=>{if(!t)return"";const e=t.split("/");return e[e.length-1]},f=t=>{try{if(t.material_files&&t.material_files.trim()){const e=JSON.parse(t.material_files);if(Array.isArray(e)&&e.length>0)return e}return t.material_file&&t.material_file.trim()?[t.material_file]:[]}catch(e){return console.error("Error parsing material_files:",e),t.material_file&&t.material_file.trim()?[t.material_file]:[]}},ne=t=>f(t).length>0,w=t=>{switch(D(t)){case"pdf":return"pdf";case"doc":case"docx":return"document";case"ppt":case"pptx":return"presentation";case"xls":case"xlsx":return"spreadsheet";case"jpg":case"jpeg":case"png":case"gif":case"bmp":return"image";case"mp4":case"avi":case"mov":case"wmv":return"video";case"mp3":case"wav":case"ogg":return"audio";case"zip":case"rar":case"7z":return"archive";default:return"file"}},P=t=>{const e=f(t);return e.length===0?"file":w(e[0])},M=we(()=>H("ios")||H("android")),L=t=>{switch(w(t)){case"pdf":return"var(--ion-color-danger)";case"document":return"var(--ion-color-primary)";case"presentation":return"var(--ion-color-warning)";case"spreadsheet":return"var(--ion-color-success)";case"image":return"var(--ion-color-tertiary)";case"video":return"var(--ion-color-secondary)";case"audio":return"var(--ion-color-dark)";default:return"var(--ion-color-medium)"}},re=t=>L(f(t)[0]||""),le=t=>{switch(P(t)){case"pdf":return"danger";case"document":return"primary";case"presentation":return"warning";case"spreadsheet":return"success";case"image":return"tertiary";case"video":return"secondary";case"audio":return"dark";default:return"medium"}},U=t=>{switch(w(t)){case"pdf":return F;case"document":return G;case"presentation":return F;case"spreadsheet":return F;case"image":return Ze;case"video":return qe;case"audio":return Je;case"archive":return He;default:return ee}},ie=t=>{const e=f(t);return e.length===0?ee:U(e[0])},ce=t=>{const e=P(t),o=f(t);if(o.length===0)return"NO FILES";if(o.length===1){const l=D(o[0]);switch(e){case"pdf":return"PDF";case"document":return"DOC";case"presentation":return"PPT";case"spreadsheet":return"XLS";case"image":return l.toUpperCase();case"video":return l.toUpperCase();case"audio":return l.toUpperCase();case"archive":return l.toUpperCase();default:return l.toUpperCase()||"FILE"}}else return"".concat(o.length," FILES")},ue=t=>{const e=w(t);return M.value&&(e==="image"||e==="pdf")?Qe:K},A=t=>{const e=new Date(t),o=new Date(e);return new Intl.DateTimeFormat("en-US",{weekday:"short",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"UTC"}).format(o)},R=async()=>{var t;try{S.value=!0,y.value=!1,v.value=[],b.value=0,E.value=0;const e=await J.get("https://klegg-app-whh7m.ondigitalocean.app/api/materials",{headers:me(),params:{tutorship_id:N},timeout:2e4});if(console.log("Course Materials response:",e.data),e.data.length>0){$.value=!0,O.value=((t=e.data[0])==null?void 0:t.tutorship_name)||"Course Materials";const o=e.data.filter(l=>l.tutorship_id===N);v.value=o.sort((l,r)=>new Date(r.created_at).getTime()-new Date(l.created_at).getTime()),b.value=v.value.length,E.value=v.value.reduce((l,r)=>l+f(r).length,0)}else $.value=!1}catch(e){he(e),y.value=!0}finally{S.value=!1}},j=async(t,e="view")=>{try{const o=await h.show({text:e==="view"?"Opening file...":"Preparing download...",position:"top"}),l="".concat(x).concat(t);window.open(l,"_blank"),await h.show({text:"File opened successfully",position:"top",duration:"short"})}catch(o){console.error("File access error:",o),await h.show({text:"Failed to open file. Please try again.",position:"top",duration:"long"})}},de=async t=>{try{const e=f(t);if(e.length===0)return;await h.show({text:"Downloading ".concat(e.length," files..."),position:"top"}),e.forEach((o,l)=>{setTimeout(()=>{const r="".concat(x).concat(o);window.open(r,"_blank")},l*100)})}catch(e){console.error("Error downloading all files:",e),await h.show({text:"Failed to download files. Please try again.",position:"top",duration:"long"})}},pe=t=>{const e=f(t);if(e.length!==0)if(e.length===1){const o="".concat(x).concat(e[0]);fe(t.material_name,t.material_description||"Check out this course material",o)}else{const o=e.map(r=>"".concat(x).concat(r)).join("\n"),l="".concat(t.material_name,"\n\n").concat(t.material_description||"Check out these course materials:","\n\n").concat(o);navigator.share?navigator.share({title:t.material_name,text:l}).then(()=>console.log("Shared successfully")).catch(r=>console.log("Error sharing:",r)):navigator.clipboard.writeText(l).then(()=>{h.show({text:"Links copied to clipboard",position:"top",duration:"short"})}).catch(r=>{console.error("Failed to copy links:",r)})}},fe=(t,e,o)=>{const l={title:t,text:e,url:o};navigator.share?navigator.share(l).then(()=>console.log("Shared successfully")).catch(r=>console.log("Error sharing:",r)):navigator.clipboard.writeText(o).then(()=>{h.show({text:"Link copied to clipboard",position:"top",duration:"short"})}).catch(r=>{console.error("Failed to copy link:",r)})},me=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(te)}),he=t=>{var e;if(console.error("Error fetching materials:",t),J.isAxiosError(t)){if(((e=t.response)==null?void 0:e.status)===401){se.replace("/"),h.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(t.code==="ECONNABORTED"){h.show({text:"Request timeout. Please try again",position:"top"});return}}h.show({text:"Failed to load materials. Please try again later",position:"top"})},z=t=>{const e=t.matches;xe(e)},V=()=>{const t=window.matchMedia("(prefers-color-scheme: dark)");return z(t),t.addEventListener("change",z),t};return ke(()=>{V(),R()}),Ce(async()=>{V()}),(t,e)=>(d(),k(a(Fe),null,{default:n(()=>[s(a(be),null,{default:n(()=>[s(a(Te),null,{default:n(()=>[s(a(Oe),{slot:"start"},{default:n(()=>[s(a(Se),{"default-href":"/"})]),_:1}),s(a($e),null,{default:n(()=>[...e[1]||(e[1]=[i("Course Materials",-1)])]),_:1})]),_:1})]),_:1}),s(a(Be),{fullscreen:!0},{default:n(()=>[c("div",Xe,[O.value?(d(),k(a(u),{key:0,class:"title"},{default:n(()=>[i(m(O.value),1)]),_:1})):C("",!0),c("div",Ye,[s(a(q),{class:"summary-card"},{default:n(()=>[s(a(Z),null,{default:n(()=>[c("div",Ge,[s(a(p),{icon:a(Q),class:"summary-icon"},null,8,["icon"]),c("div",null,[s(a(u),{class:"summary-count"},{default:n(()=>[i(m(b.value),1)]),_:1}),s(a(u),{class:"summary-label"},{default:n(()=>[...e[2]||(e[2]=[i("Materials",-1)])]),_:1})])])]),_:1})]),_:1}),s(a(q),{class:"summary-card"},{default:n(()=>[s(a(Z),null,{default:n(()=>[c("div",Ke,[s(a(p),{icon:a(F),class:"summary-icon"},null,8,["icon"]),c("div",null,[s(a(u),{class:"summary-count"},{default:n(()=>[i(m(E.value),1)]),_:1}),s(a(u),{class:"summary-label"},{default:n(()=>[...e[3]||(e[3]=[i("Files",-1)])]),_:1})])])]),_:1})]),_:1})])]),S.value?(d(),g("div",et,[s(a(Ee),{name:"crescent",color:"primary"})])):!$.value&&!y.value?(d(),g("div",tt,[s(a(p),{icon:a(Q),color:"medium"},null,8,["icon"]),s(a(u),null,{default:n(()=>[...e[4]||(e[4]=[c("h3",null,"No Course Materials",-1),c("p",null,"Your course materials will appear here when uploaded by your teacher",-1)])]),_:1}),s(a(I),{fill:"clear",onClick:e[0]||(e[0]=o=>t.$router.back())},{default:n(()=>[...e[5]||(e[5]=[i("Back to Classes",-1)])]),_:1})])):y.value?(d(),g("div",at,[s(a(p),{icon:a(De),color:"warning"},null,8,["icon"]),s(a(u),null,{default:n(()=>[...e[6]||(e[6]=[c("h3",null,"Error Loading Materials",-1),c("p",null,"Please try again later",-1)])]),_:1}),s(a(I),{fill:"clear",onClick:R},{default:n(()=>[...e[7]||(e[7]=[i("Retry",-1)])]),_:1})])):(d(),g("div",st,[s(a(Me),{lines:"none"},{default:n(()=>[(d(!0),g(W,null,X(v.value,(o,l)=>(d(),k(a(Ne),{key:o.material_id||l},{default:n(()=>[s(a(Pe),{class:"material-item",detail:!1},{default:n(()=>[c("div",{slot:"start",class:"type-indicator",style:Y({backgroundColor:re(o)})},null,4),s(a(Le),{class:"material-content"},{default:n(()=>[c("div",ot,[s(a(u),{class:"material-title"},{default:n(()=>[i(m(o.material_name||"Untitled Material"),1)]),_:2},1024),s(a(Ue),{color:le(o)},{default:n(()=>[s(a(p),{icon:ie(o),slot:"start"},null,8,["icon"]),i(" "+m(ce(o)),1)]),_:2},1032,["color"])]),c("div",nt,[s(a(u),{class:"material-date"},{default:n(()=>[s(a(p),{icon:a(G)},null,8,["icon"]),i(" Posted: "+m(o.material_description?A(o.created_at):"N/A"),1)]),_:2},1024)]),o.material_description?(d(),g("div",rt,[s(a(u),{class:"theme-text-nine"},{default:n(()=>[i(m(o.material_description),1)]),_:2},1024)])):C("",!0),ne(o)?(d(),g("div",lt,[s(a(u),{class:"files-label"},{default:n(()=>[...e[8]||(e[8]=[i("Attached Files:",-1)])]),_:1}),c("div",it,[(d(!0),g(W,null,X(f(o),(r,ge)=>(d(),g("div",{key:ge,class:"file-item",onClick:_e=>j(r,M.value?"view":"download")},[s(a(p),{icon:U(r),class:"file-icon",style:Y({color:L(r)})},null,8,["icon","style"]),c("div",ut,[s(a(u),{class:"file-name"},{default:n(()=>[i(m(oe(r)),1)]),_:2},1024),s(a(u),{class:"file-type"},{default:n(()=>[i(m(D(r).toUpperCase()),1)]),_:2},1024)]),s(a(I),{fill:"clear",size:"small",class:"file-action-btn",onClick:Ae(_e=>j(r,M.value?"view":"download"),["stop"])},{default:n(()=>[s(a(p),{slot:"icon-only",icon:ue(r)},null,8,["icon"])]),_:2},1032,["onClick"])],8,ct))),128))])])):C("",!0),c("div",dt,[s(a(u),{class:"upload-date"},{default:n(()=>[s(a(p),{icon:a(Re)},null,8,["icon"]),i(" Uploaded: "+m(A(o.created_at)),1)]),_:2},1024),f(o).length>1?(d(),k(a(I),{key:0,fill:"clear",size:"small",onClick:r=>de(o)},{default:n(()=>[s(a(p),{slot:"start",icon:a(K)},null,8,["icon"]),e[9]||(e[9]=i(" Download All ",-1))]),_:1},8,["onClick"])):C("",!0)])]),_:2},1024)]),_:2},1024),s(a(je),{side:"end"},{default:n(()=>[s(a(ze),{color:"tertiary",onClick:r=>pe(o)},{default:n(()=>[s(a(p),{slot:"icon-only",icon:a(Ve)},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1}))}}),gt=We(pt,[["__scopeId","data-v-94c3fac4"]]);export{gt as default};
