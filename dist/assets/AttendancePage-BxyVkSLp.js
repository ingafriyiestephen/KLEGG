import{d as J,ao as U,r as _,S as w,a as K,o as W,b as C,w as a,u as e,I as Y,e as T,f as G,g as t,h as Q,i as X,P as Z,l as ee,A as r,q as te,k as l,s as m,a9 as O,a3 as c,t as d,x as L,C as N,n as i,aq as ae,ar as ne,v as se,J as oe,a2 as le,m as re,a4 as ce,T as ie,U as ue,M as de,N as u,as as _e,a7 as me,$ as D,K as fe,at as pe,au as ge,av as ve,aw as ye,ax as he,ay as ke,az as Ie,aA as we,aB as Ce,aC as Oe,aD as Se,F as be,_ as Ae}from"./index-6dl2zJ1O.js";import{T as S}from"./index-fbeSVdeg.js";const xe={class:"header-section ion-padding"},Be={class:"summary-cards"},Te={class:"summary-content"},Le={class:"summary-content"},Ne={key:0,class:"loading-container"},De={key:1,class:"empty-state"},Pe={key:2,class:"error-state"},Re={key:3},Ee={class:"attendance-header"},Fe={class:"attendance-details"},Ve={class:"detail-row"},qe={class:"detail-row"},ze={key:0,class:"detail-row"},Me={key:1,class:"detail-row"},$e={slot:"end",class:"attendance-icon"},je=J({__name:"AttendancePage",setup(He){const P=localStorage.getItem("parisklegg_token")||"",b=localStorage.getItem("parisklegg_user"),g=b?JSON.parse(b):null,R=(g==null?void 0:g.user_id)||0,E=U(),F=G(),V=Number(E.params.id),v=_(""),y=_(!0),f=_(!1),A=_(!1),h=_([]),k=_(0),I=_(0),x=n=>{switch(n==null?void 0:n.toLowerCase()){case"present":return"var(--ion-color-success)";case"absent":return"var(--ion-color-danger)";case"late":return"var(--ion-color-warning)";case"sick":return"var(--ion-color-primary)";default:return"var(--ion-color-medium)"}},q=n=>{switch(n==null?void 0:n.toLowerCase()){case"present":return be;case"absent":return Se;case"late":return Oe;case"sick":return Ce;default:return we}},z=n=>{switch(n==null?void 0:n.toLowerCase()){case"present":return"success";case"absent":return"danger";case"late":return"warning";case"sick":return"primary";default:return"medium"}},M=n=>new Date(n).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=async()=>{try{y.value=!0,f.value=!1,h.value=[],k.value=0,I.value=0;const o=(await T.get("https://school.klgilc.com/api/attendances",{headers:j(),timeout:2e4})).data.filter(s=>s.tutorship_id===V&&s.user_id===R);console.log("Filtered user attendance records:",o),o.length>0&&(A.value=!0,v.value=o[0].tutorship_name||"My Attendance",o.forEach(s=>{s.student_attendance.toLowerCase()==="present"?k.value++:s.student_attendance.toLowerCase()==="absent"&&I.value++}),h.value=o.sort((s,p)=>new Date(p.attendance_date||p.created_at).getTime()-new Date(s.attendance_date||s.created_at).getTime()))}catch(n){H(n),f.value=!0}finally{y.value=!1}},$=n=>{console.log("Reporting issue for record:",n)},j=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(P)}),H=n=>{var o;if(console.error("Error fetching data:",n),T.isAxiosError(n)){if(((o=n.response)==null?void 0:o.status)===401){F.replace("/"),S.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(n.code==="ECONNABORTED"){S.show({text:"Request timeout. Please try again",position:"top"});return}}S.show({text:"Failed to load data. Please try again later",position:"top"})};return w.setOverlaysWebView({overlay:!1}),w.setBackgroundColor({color:"#ffffff"}),w.setStyle({style:K.Light}),W(()=>{B()}),(n,o)=>(u(),C(e(Y),null,{default:a(()=>[t(e(te),null,{default:a(()=>[t(e(Q),null,{default:a(()=>[t(e(X),{slot:"start"},{default:a(()=>[t(e(Z),{"default-href":"/"})]),_:1}),t(e(ee),null,{default:a(()=>o[0]||(o[0]=[r("Attendance",-1)])),_:1,__:[0]})]),_:1})]),_:1}),t(e(de),{fullscreen:!0},{default:a(()=>[l("div",xe,[v.value?(u(),C(e(c),{key:0,class:"title"},{default:a(()=>[r(d(v.value),1)]),_:1})):O("",!0),l("div",Be,[t(e(L),{class:"summary-card present"},{default:a(()=>[t(e(N),null,{default:a(()=>[l("div",Te,[t(e(i),{icon:e(ae),class:"summary-icon"},null,8,["icon"]),l("div",null,[t(e(c),{class:"summary-count"},{default:a(()=>[r(d(k.value),1)]),_:1}),t(e(c),{class:"summary-label"},{default:a(()=>o[1]||(o[1]=[r("Present",-1)])),_:1,__:[1]})])])]),_:1})]),_:1}),t(e(L),{class:"summary-card absent"},{default:a(()=>[t(e(N),null,{default:a(()=>[l("div",Le,[t(e(i),{icon:e(ne),class:"summary-icon"},null,8,["icon"]),l("div",null,[t(e(c),{class:"summary-count"},{default:a(()=>[r(d(I.value),1)]),_:1}),t(e(c),{class:"summary-label"},{default:a(()=>o[2]||(o[2]=[r("Absent",-1)])),_:1,__:[2]})])])]),_:1})]),_:1})])]),y.value?(u(),m("div",Ne,[t(e(se),{name:"crescent",color:"primary"})])):!A.value&&!f.value?(u(),m("div",De,[t(e(i),{icon:e(oe),color:"medium"},null,8,["icon"]),t(e(c),null,{default:a(()=>o[3]||(o[3]=[l("h3",null,"No Attendance Records",-1),l("p",null,"Your attendance will appear here when marked by your teacher",-1)])),_:1,__:[3]})])):f.value?(u(),m("div",Pe,[t(e(i),{icon:e(le),color:"danger"},null,8,["icon"]),t(e(c),null,{default:a(()=>o[4]||(o[4]=[l("h3",null,"Error Loading Attendance",-1),l("p",null,"Please try again later",-1)])),_:1,__:[4]}),t(e(re),{fill:"clear",onClick:B},{default:a(()=>o[5]||(o[5]=[r("Retry",-1)])),_:1,__:[5]})])):(u(),m("div",Re,[t(e(ce),{lines:"none"},{default:a(()=>[(u(!0),m(ie,null,ue(h.value,(s,p)=>(u(),C(e(_e),{key:p},{default:a(()=>[t(e(me),{class:"attendance-item",detail:!1},{default:a(()=>[l("div",{slot:"start",class:"status-indicator",style:D({backgroundColor:x(s.student_attendance)})},null,4),t(e(fe),{class:"attendance-content"},{default:a(()=>[l("div",Ee,[t(e(c),{class:"attendance-status",style:D({color:x(s.student_attendance)})},{default:a(()=>[r(d(s.student_attendance),1)]),_:2},1032,["style"]),t(e(c),{class:"attendance-date"},{default:a(()=>[r(d(M(s.attendance_date||s.created_at)),1)]),_:2},1024)]),l("div",Fe,[l("div",Ve,[t(e(i),{icon:e(pe)},null,8,["icon"]),t(e(c),null,{default:a(()=>[r(d(s.student_name),1)]),_:2},1024)]),l("div",qe,[t(e(i),{icon:e(ge)},null,8,["icon"]),t(e(c),null,{default:a(()=>[r(d(s.teacher_name),1)]),_:2},1024)]),s.attendance_code?(u(),m("div",ze,[t(e(i),{icon:e(ve)},null,8,["icon"]),t(e(c),null,{default:a(()=>[r("Code: "+d(s.attendance_code),1)]),_:2},1024)])):O("",!0),s.remark?(u(),m("div",Me,[t(e(i),{icon:e(ye)},null,8,["icon"]),t(e(c),null,{default:a(()=>[r(d(s.remark),1)]),_:2},1024)])):O("",!0)])]),_:2},1024),l("div",$e,[t(e(i),{icon:q(s.student_attendance),color:z(s.student_attendance)},null,8,["icon","color"])])]),_:2},1024),t(e(he),{side:"end"},{default:a(()=>[t(e(ke),{color:"danger",onClick:Je=>$(s)},{default:a(()=>[t(e(i),{slot:"icon-only",icon:e(Ie)},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1}))}}),We=Ae(je,[["__scopeId","data-v-7d690fba"]]);export{We as default};
