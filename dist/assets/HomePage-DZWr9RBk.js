import{d as W,r as I,c as m,o as X,a as Z,w as o,u as t,I as tt,i as P,b as C,e as et,f as nt,g as e,h as at,j as R,k as ot,l as s,m as st,t as c,n as H,p as l,q as it,s as lt,v as d,x as rt,y as T,z as D,A as b,B as i,C as L,D as N,E as M,F as ct,G as dt,H as ut,J as ft,K as pt,L as gt,M as _t,N as mt,O as r,_ as vt}from"./index-Bfnbz8KY.js";import{T as u}from"./index-CmNb0h0M.js";const ht=["src"],yt={class:"greeting"},kt={class:"student-name"},wt={key:0,class:"loading-container"},It={key:1},Ct={key:0,class:"notification-content"},Tt={key:1,class:"empty-state"},Dt={key:0,class:"attendance-content"},bt={key:1,class:"empty-state"},Nt={class:"quick-actions-grid"},xt={class:"action-icon-wrapper"},At={class:"action-icon-wrapper"},Ot={class:"action-icon-wrapper"},St=W({__name:"HomePage",setup(Bt){const q=localStorage.getItem("parisklegg_token")||"",x=localStorage.getItem("parisklegg_user"),v=x?JSON.parse(x):null,z=(v==null?void 0:v.fullname)||"",f=et(),p=I(!0),h=I([]),y=I([]),G=m(()=>{const a=new Date().getHours();return a<12?"Good Morning":a<18?"Good Afternoon":"Good Evening"}),k=m(()=>h.value.length>0?h.value[0]:null),w=m(()=>y.value.length>0?y.value[0]:null),V=m(()=>"/assets/img/login-logo.png"),j=()=>{const a=document.body;a.classList.remove("ios","android"),P("ios")?a.classList.add("ios"):P("android")&&a.classList.add("android")},A=a=>{const n=new Date(a),U=Math.abs(new Date().getTime()-n.getTime()),_=Math.floor(U/(1e3*60*60*24));return _===0?"Today":_===1?"Yesterday":_<7?"".concat(_," days ago"):n.toLocaleDateString()},F=(a,n)=>a?a.length>n?a.substring(0,n)+"...":a:"",J=()=>f.push("/tutorships"),O=()=>f.push("/notifications"),Y=()=>f.push("/settings"),$=async()=>{p.value=!0;try{await S(),await u.show({text:"Data refreshed",position:"top"})}catch(a){console.error("Refresh error:",a),await u.show({text:"Refresh failed",position:"top"})}finally{p.value=!1}},S=async()=>{try{const[a,n]=await Promise.all([C.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications",{headers:B()}),C.get("https://klegg-app-whh7m.ondigitalocean.app/api/attendances",{headers:B()})]);h.value=a.data,y.value=n.data}catch(a){K(a)}},B=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(q)}),K=a=>{var n;if(console.error("Error fetching data:",a),C.isAxiosError(a)){if(((n=a.response)==null?void 0:n.status)===401){f.replace("/"),u.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(a.code==="ECONNABORTED"){u.show({text:"Request timeout. Please try again",position:"top"});return}}u.show({text:"Failed to load data. Please try again later",position:"top"})},E=a=>{const n=a.matches;nt(n)},Q=()=>{const a=window.matchMedia("(prefers-color-scheme: dark)");return E(a),a.addEventListener("change",E),a};return X(async()=>{try{j(),Q(),await S()}catch(a){console.error("Initialization error:",a)}finally{p.value=!1}}),(a,n)=>{const g=gt("ion-text");return r(),Z(t(tt),null,{default:o(()=>[e(t(lt),{class:"ion-no-border"},{default:o(()=>[e(t(at),null,{default:o(()=>[e(t(R),{slot:"start"},{default:o(()=>[e(t(ot),{class:"toolbar-avatar"},{default:o(()=>[s("img",{src:V.value,alt:"Student"},null,8,ht)]),_:1})]),_:1}),e(t(st),{class:"toolbar-title"},{default:o(()=>[s("div",yt,c(G.value),1),s("div",kt,c(t(z)),1)]),_:1}),e(t(R),{slot:"end"},{default:o(()=>[e(t(H),{onClick:$,fill:"clear"},{default:o(()=>[e(t(l),{icon:t(it),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),e(t(mt),{fullscreen:!0},{default:o(()=>[p.value?(r(),d("div",wt,[e(t(rt),{name:"crescent"}),n[0]||(n[0]=s("p",null,"Loading your data...",-1))])):(r(),d("div",It,[e(t(T),{class:"content-card"},{default:o(()=>[e(t(D),null,{default:o(()=>[e(t(b),null,{default:o(()=>[e(t(l),{icon:t(L)},null,8,["icon"]),n[1]||(n[1]=i(" Recent Updates ",-1))]),_:1})]),_:1}),e(t(N),null,{default:o(()=>[k.value?(r(),d("div",Ct,[s("p",null,c(F(k.value.notification_body,100)),1),e(t(M),null,{default:o(()=>[i(c(A(k.value.created_at)),1)]),_:1})])):(r(),d("div",Tt,[e(t(l),{icon:t(ct)},null,8,["icon"]),n[2]||(n[2]=s("p",null,"No recent updates",-1))])),e(t(H),{expand:"block",fill:"clear",size:"small",onClick:O,class:"view-all-button"},{default:o(()=>[...n[3]||(n[3]=[i(" View All Notifications ",-1)])]),_:1})]),_:1})]),_:1}),e(t(T),{class:"content-card"},{default:o(()=>[e(t(D),null,{default:o(()=>[e(t(b),null,{default:o(()=>[e(t(l),{icon:t(dt)},null,8,["icon"]),n[4]||(n[4]=i(" Recent Attendance ",-1))]),_:1})]),_:1}),e(t(N),null,{default:o(()=>[w.value?(r(),d("div",Dt,[s("p",null,[n[5]||(n[5]=i(" You were marked ",-1)),s("strong",null,c(w.value.student_attendance),1)]),e(t(M),null,{default:o(()=>[i(c(A(w.value.created_at)),1)]),_:1})])):(r(),d("div",bt,[e(t(l),{icon:t(ut)},null,8,["icon"]),n[6]||(n[6]=s("p",null,"No attendance records yet",-1))]))]),_:1})]),_:1}),e(t(T),{class:"content-card"},{default:o(()=>[e(t(D),null,{default:o(()=>[e(t(b),null,{default:o(()=>[e(t(l),{icon:t(ft)},null,8,["icon"]),n[7]||(n[7]=i(" Quick Actions ",-1))]),_:1})]),_:1}),e(t(N),{class:"quick-actions-container"},{default:o(()=>[s("div",Nt,[s("div",{class:"action-item",onClick:J},[s("div",xt,[e(t(l),{icon:t(pt),class:"action-icon"},null,8,["icon"])]),e(g,{class:"action-label"},{default:o(()=>[...n[8]||(n[8]=[i("Classes",-1)])]),_:1})]),s("div",{class:"action-item",onClick:O},[s("div",At,[e(t(l),{icon:t(L),class:"action-icon"},null,8,["icon"])]),e(g,{class:"action-label"},{default:o(()=>[...n[9]||(n[9]=[i("Notifications",-1)])]),_:1})]),s("div",{class:"action-item",onClick:Y},[s("div",Ot,[e(t(l),{icon:t(_t),class:"action-icon"},null,8,["icon"])]),e(g,{class:"action-label"},{default:o(()=>[...n[10]||(n[10]=[i("Settings",-1)])]),_:1})])])]),_:1})]),_:1})]))]),_:1})]),_:1})}}}),Rt=vt(St,[["__scopeId","data-v-81efc490"]]);export{Rt as default};
