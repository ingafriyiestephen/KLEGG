import{d as ue,ao as ce,r as p,o as me,P as de,ap as ge,a as D,w as a,u as n,I as fe,b as A,e as pe,f as we,g as o,h as he,j as _e,aq as Te,m as ke,B as u,s as De,l as w,v as c,a9 as _,a2 as g,t as d,x as ve,p as v,K as Ce,a1 as Ie,n as V,R as Je,S as be,N as Me,O as i,y as Se,V as Ee,z as Be,A as Le,ar as xe,D as Pe,a6 as Ke,H as C,a8 as Ne,as as $e,_ as Oe}from"./index-Bfnbz8KY.js";import{T as h}from"./index-CmNb0h0M.js";const je={class:"header-section"},ze={key:0,class:"loading-container"},Fe={key:1,class:"empty-state"},Re={key:2,class:"error-state"},Ae={key:3,class:"timetable-container"},Ve={key:0,class:"join-section"},He={key:0,class:"no-link-message"},We={key:1,class:"countdown"},qe={key:2,class:"status-message"},Ue={key:1,class:"not-today-message"},ye=ue({__name:"ClassroomPage",setup(Ye){const H=localStorage.getItem("parisklegg_token")||"",E=localStorage.getItem("parisklegg_user");E&&JSON.parse(E);const W=ce(),q=pe(),B=Number(W.params.id),T=p(""),L=p(""),I=p(!0),J=p(!1),b=p(!1),k=p([]);let f=null;const U=()=>{const e=new Date,s=e.getDay()||7,t=new Date(e);t.setDate(e.getDate()-s+1);const l=new Date(t);l.setDate(t.getDate()+6);const r={month:"short",day:"numeric"};return"".concat(t.toLocaleDateString(void 0,r)," - ").concat(l.toLocaleDateString(void 0,r))},y=e=>e.classEnded?"Class Ended":e.classInProgress?e.meetingLink?"Join Now":"No Link":e.canJoin?e.meetingLink?"Join Soon":"No Link":"Join Soon",Y=e=>e.classEnded?"medium":e.classInProgress?"success":e.canJoin?"primary":"medium",G=e=>e.classEnded?"outline":e.classInProgress||e.canJoin?"solid":"outline",Q=e=>e.classEnded?C:e.classInProgress?$e:e.canJoin?C:C,X=(e,s)=>!!e&&e.trim()!==""&&!!s&&s.trim()!=="",x=e=>{const[s,t]=e.split(":").map(Number),l=new Date;return l.setHours(s,t,0,0),l},P=(e,s)=>{const t=new Date;return t>=e&&t<s},K=e=>new Date>=e,N=e=>{const s=new Date,t=new Date(e.getTime()-10*60*1e3);if(s<t){const l=t.getTime()-s.getTime(),r=Math.floor(l/(1e3*60*60)),m=Math.floor(l%(1e3*60*60)/(1e3*60));return r>0?"".concat(r,"h ").concat(m,"m"):"".concat(m,"m")}return""},Z=()=>{k.value.forEach(e=>{if(e.isToday&&e.startDateTime&&e.endDateTime){const s=new Date,t=new Date(e.startDateTime.getTime()-10*60*1e3);e.canJoin=!1,e.statusMessage="",e.statusColor="medium",s<t?(e.countdown=N(e.startDateTime),e.statusMessage="Join available at ".concat($(t))):s>=t&&s<e.startDateTime?(e.canJoin=!0,e.countdown="",e.statusMessage="Join now to enter class",e.statusColor="success"):P(e.startDateTime,e.endDateTime)?(e.canJoin=!0,e.countdown="",e.statusMessage="Class in progress - Join now",e.statusColor="warning"):K(e.endDateTime)&&(e.countdown="",e.statusMessage="Class has ended",e.statusColor="danger")}})},$=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),O=async()=>{try{I.value=!0,J.value=!1;const e=await A.post("https://klegg-app-whh7m.ondigitalocean.app/api/timetable",{tutorship_id:B},{headers:oe(),timeout:2e4});console.log("Timetable response:",e.data),ee(e.data)}catch(e){ae(e),J.value=!0}finally{I.value=!1}},ee=e=>{const s=[{name:"Monday",dayKey:"monday"},{name:"Tuesday",dayKey:"tuesday"},{name:"Wednesday",dayKey:"wednesday"},{name:"Thursday",dayKey:"thursday"},{name:"Friday",dayKey:"friday"},{name:"Saturday",dayKey:"saturday"},{name:"Sunday",dayKey:"sunday"}],t=new Date().getDay(),l=s[t===0?6:t-1].dayKey;k.value=[],b.value=!1,e.forEach(r=>{r.tutorship_id===B&&(T.value=r.tutorship_name||"My Timetable",s.forEach(m=>{const M=r["".concat(m.dayKey,"_start")],S=r["".concat(m.dayKey,"_end")];if(X(M,S)){b.value=!0;const ie=x(M),le=x(S),F=m.dayKey===l,re=r["".concat(m.dayKey,"_meeting_link")],R={name:m.name,dayKey:m.dayKey,startTime:M,endTime:S,isToday:F,canJoin:!1,classInProgress:!1,classEnded:!1,startDateTime:ie,endDateTime:le,meetingLink:re};F&&te(R),k.value.push(R)}}))}),se()},te=e=>{if(!e.startDateTime||!e.endDateTime)return;const s=new Date,t=new Date(e.startDateTime.getTime()-10*60*1e3);e.canJoin=!1,e.classInProgress=!1,e.classEnded=!1,e.countdown="",e.statusMessage="",e.statusColor="medium",s<t?(e.countdown=N(e.startDateTime),e.statusMessage="Join available at ".concat($(t)),e.statusColor="medium"):s>=t&&s<e.startDateTime?(e.canJoin=!0,e.statusMessage="Class starting soon - Join now",e.statusColor="success"):P(e.startDateTime,e.endDateTime)?(e.canJoin=!0,e.classInProgress=!0,e.statusMessage="Class in progress",e.statusColor="warning"):K(e.endDateTime)&&(e.classEnded=!0,e.statusMessage="Class has ended",e.statusColor="danger")},se=()=>{f&&clearInterval(f),f=window.setInterval(()=>{Z()},6e4)},ne=async e=>{if(!e.canJoin||!e.meetingLink){e.meetingLink||h.show({text:"Meeting link not available for this class",position:"top",duration:"short"});return}try{if(h.show({text:"Opening ".concat(T.value," class..."),position:"top",duration:"short"}),e.meetingLink.includes("zoom.us")){const s=e.meetingLink.replace("/j/","/join/");window.open(s,"_system")}else e.meetingLink.includes("meet.google.com")?window.open(e.meetingLink,"_system"):window.open(e.meetingLink,"_blank")}catch(s){console.error("Error joining class:",s),h.show({text:"Failed to open meeting link",position:"top",duration:"short"})}},oe=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(H)}),ae=e=>{var s;if(console.error("Error fetching data:",e),A.isAxiosError(e)){if(((s=e.response)==null?void 0:s.status)===401){q.replace("/"),h.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(e.code==="ECONNABORTED"){h.show({text:"Request timeout. Please try again",position:"top"});return}}h.show({text:"Failed to load data. Please try again later",position:"top"})},j=e=>{const s=e.matches;we(s)},z=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");return j(e),e.addEventListener("change",j),e};return me(()=>{z(),L.value=U(),O()}),de(async()=>{z()}),ge(()=>{f&&(clearInterval(f),f=null)}),(e,s)=>(i(),D(n(fe),null,{default:a(()=>[o(n(De),null,{default:a(()=>[o(n(he),null,{default:a(()=>[o(n(_e),{slot:"start"},{default:a(()=>[o(n(Te),{"default-href":"/"})]),_:1}),o(n(ke),null,{default:a(()=>[...s[0]||(s[0]=[u("Classroom",-1)])]),_:1})]),_:1})]),_:1}),o(n(Me),{class:"ion-padding",fullscreen:!0},{default:a(()=>[w("div",je,[T.value?(i(),D(n(g),{key:0,class:"title"},{default:a(()=>[u(d(T.value),1)]),_:1})):_("",!0),o(n(g),{class:"subtitle"},{default:a(()=>[u(d(L.value),1)]),_:1})]),I.value?(i(),c("div",ze,[o(n(ve),{name:"crescent",color:"primary"})])):b.value?J.value?(i(),c("div",Re,[o(n(v),{icon:n(Ie),color:"danger",size:"large"},null,8,["icon"]),o(n(g),null,{default:a(()=>[...s[2]||(s[2]=[w("h3",null,"Failed to load timetable",-1),w("p",null,"Please try again later",-1)])]),_:1}),o(n(V),{onClick:O,fill:"clear"},{default:a(()=>[...s[3]||(s[3]=[u("Retry",-1)])]),_:1})])):(i(),c("div",Ae,[(i(!0),c(Je,null,be(k.value,(t,l)=>(i(),D(n(Se),{key:l,class:Ee(["day-card",{"today-card":t.isToday}])},{default:a(()=>[o(n(Be),null,{default:a(()=>[o(n(Le),{class:"day-title"},{default:a(()=>[u(d(t.name)+" ",1),t.isToday?(i(),D(n(xe),{key:0,color:"success"},{default:a(()=>[...s[4]||(s[4]=[u("Today",-1)])]),_:1})):_("",!0)]),_:2},1024)]),_:2},1024),o(n(Pe),{class:"time-content"},{default:a(()=>[o(n(Ke),{lines:"none"},{default:a(()=>[o(n(v),{slot:"start",icon:n(C),color:"primary"},null,8,["icon"]),o(n(Ne),null,{default:a(()=>[u(d(t.startTime)+" - "+d(t.endTime),1)]),_:2},1024)]),_:2},1024),t.isToday?(i(),c("div",Ve,[o(n(V),{class:"join-button",disabled:!t.canJoin||!t.meetingLink,fill:G(t),color:Y(t),onClick:r=>ne(t),expand:"block"},{default:a(()=>[o(n(v),{slot:"start",icon:Q(t)},null,8,["icon"]),u(" "+d(y(t)),1)]),_:2},1032,["disabled","fill","color","onClick"]),!t.meetingLink&&t.canJoin?(i(),c("div",He,[o(n(g),{color:"danger"},{default:a(()=>[...s[5]||(s[5]=[w("small",null,"Meeting link not available",-1)])]),_:1})])):_("",!0),t.countdown&&!t.canJoin&&!t.classInProgress?(i(),c("div",We,[o(n(g),{color:"medium"},{default:a(()=>[u(" Starts in "+d(t.countdown),1)]),_:2},1024)])):_("",!0),t.statusMessage?(i(),c("div",qe,[o(n(g),{color:t.statusColor},{default:a(()=>[u(d(t.statusMessage),1)]),_:2},1032,["color"])])):_("",!0)])):(i(),c("div",Ue,[o(n(g),{color:"medium"},{default:a(()=>[u(" Join link will be available on "+d(t.name),1)]),_:2},1024)]))]),_:2},1024)]),_:2},1032,["class"]))),128))])):(i(),c("div",Fe,[o(n(v),{icon:n(Ce),size:"large"},null,8,["icon"]),o(n(g),null,{default:a(()=>[...s[1]||(s[1]=[w("h3",null,"No Classes Scheduled",-1),w("p",null,"Your timetable will appear here when classes are scheduled",-1)])]),_:1})]))]),_:1})]),_:1}))}}),Xe=Oe(ye,[["__scopeId","data-v-72730a9a"]]);export{Xe as default};
