import{d as q,r as u,P as J,o as W,a as m,w as s,u as a,I as Y,b as T,e as G,f as K,g as o,h as Q,m as X,B as h,s as Z,v as c,l as i,x as tt,p as _,a1 as et,a2 as E,n as at,F as ot,a3 as nt,S as P,R as B,a4 as st,a5 as lt,N as it,L as rt,O as l,a6 as ct,V as ut,k as dt,a7 as ft,a8 as D,a9 as L,t as f,aa as pt,ab as gt,ac as mt,ad as A,_ as ht}from"./index-Bfnbz8KY.js";import{T as N}from"./index-CmNb0h0M.js";const _t={key:0,class:"loading-container"},vt={key:1,class:"error-state"},yt={key:2,class:"empty-state"},It={class:"preview-text"},kt={key:0,class:"reactions-row"},Nt={class:"notification-meta"},wt={class:"date"},bt={key:0,class:"comments-count"},St=q({__name:"NotificationsPage",setup(xt){const w=localStorage.getItem("parisklegg_token")||"",b=localStorage.getItem("parisklegg_user");b&&JSON.parse(b);const R=e=>({like:A,heart:mt,"thumbs-up":gt})[e]||A,S=G(),p=u(!0),g=u(!1),v=u(!1),r=u([]),y=u(1),I=u(!0),d=async(e=1)=>{try{if(e===1?(p.value=!0,r.value=[]):g.value=!0,v.value=!1,!w)throw new Error("No authentication token found");const t=await T.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications",{headers:j(),timeout:1e4,params:{page:e}});e===1?r.value=t.data.data:r.value=[...r.value,...t.data.data],y.value=e,I.value=!!t.data.next_page_url,console.log("Notifications fetched successfully:",r.value)}catch(t){$(t),v.value=!0}finally{p.value=!1,g.value=!1}},V=async e=>{await d(y.value+1),e.target.complete()},H=e=>{const t=e.target;if(!t)return;const k=t.scrollHeight;t.scrollTop+t.clientHeight>k*.8&&I.value&&!g.value&&d(y.value+1)},z=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),F=(e,t)=>e.length<=t?e:e.substring(0,t)+"...",M=e=>{S.push("/notifications/".concat(e))};J(async()=>{await d()});const j=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(w)}),$=e=>{var t;if(console.error("Error fetching data:",e),T.isAxiosError(e)){if(((t=e.response)==null?void 0:t.status)===401){S.replace("/"),N.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(e.code==="ECONNABORTED"){N.show({text:"Request timeout. Please try again",position:"top"});return}}N.show({text:"Failed to load data. Please try again later",position:"top"})},x=e=>{const t=e.matches;K(t)},U=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");return x(e),e.addEventListener("change",x),e};return W(()=>{U(),d()}),(e,t)=>{const k=rt("ion-chip");return l(),m(a(Y),null,{default:s(()=>[o(a(Z),null,{default:s(()=>[o(a(Q),null,{default:s(()=>[o(a(X),null,{default:s(()=>[...t[2]||(t[2]=[h("Notifications",-1)])]),_:1})]),_:1})]),_:1}),o(a(it),{fullscreen:!0,onIonScroll:t[1]||(t[1]=n=>H(n))},{default:s(()=>[p.value&&!g.value?(l(),c("div",_t,[o(a(tt),{name:"crescent",color:"primary"}),t[3]||(t[3]=i("p",null,"Loading notifications...",-1))])):v.value?(l(),c("div",vt,[o(a(_),{icon:a(et),color:"danger",size:"large"},null,8,["icon"]),o(a(E),null,{default:s(()=>[...t[4]||(t[4]=[i("h3",null,"Error Loading Notifications",-1),i("p",null,"Please try again later",-1)])]),_:1}),o(a(at),{fill:"clear",onClick:d},{default:s(()=>[...t[5]||(t[5]=[h("Retry",-1)])]),_:1})])):r.value.length===0&&!p.value?(l(),c("div",yt,[o(a(_),{icon:a(ot),color:"medium",size:"large"},null,8,["icon"]),o(a(E),null,{default:s(()=>[...t[6]||(t[6]=[i("h3",null,"No Notifications",-1),i("p",null,"You don't have any notifications yet",-1)])]),_:1})])):(l(),m(a(nt),{key:3},{default:s(()=>[(l(!0),c(B,null,P(r.value,n=>(l(),m(a(ct),{key:n.id,onClick:C=>M(n.id),class:ut(["notification-item",{unread:!n.is_read}])},{default:s(()=>[o(a(dt),{slot:"start",class:"notification-avatar"},{default:s(()=>[...t[7]||(t[7]=[i("img",{src:ft,alt:"School Logo"},null,-1)])]),_:1}),o(a(D),null,{default:s(()=>[i("h2",null,f(n.title),1),i("p",It,f(F(n.body,60)),1),n.reaction_counts&&Object.keys(n.reaction_counts).length?(l(),c("div",kt,[(l(!0),c(B,null,P(n.reaction_counts,(C,O)=>(l(),m(k,{key:O,color:"light",class:"reaction-chip"},{default:s(()=>[o(a(_),{icon:R(O)},null,8,["icon"]),o(a(D),null,{default:s(()=>[h(f(C),1)]),_:2},1024)]),_:2},1024))),128))])):L("",!0),i("div",Nt,[i("span",wt,f(z(n.created_at)),1),n.comments_count?(l(),c("span",bt,[o(a(_),{icon:a(pt)},null,8,["icon"]),h(" "+f(n.comments_count),1)])):L("",!0)])]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})),o(a(st),{onIonInfinite:t[0]||(t[0]=n=>V(n)),threshold:"100px",disabled:!I.value},{default:s(()=>[o(a(lt),{"loading-spinner":"bubbles","loading-text":"Loading more notifications..."})]),_:1},8,["disabled"])]),_:1})]),_:1})}}}),Tt=ht(St,[["__scopeId","data-v-5088ec86"]]);export{Tt as default};
