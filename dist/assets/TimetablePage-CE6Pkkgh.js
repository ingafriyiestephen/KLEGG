import{d as V,ar as $,r as u,S as b,a as W,o as H,b as f,w as o,u as e,I as j,e as N,f as q,g as s,h as J,i as G,P as U,l as X,A as i,q as Y,k as y,s as m,a9 as E,a3 as _,t as p,v as Q,n as D,J as Z,a2 as ee,m as ae,T as te,U as se,M as oe,N as l,x as ne,X as le,y as re,z as ie,as as de,C as ue,a7 as ce,G as ye,K as me,_ as pe}from"./index-CnbctnAi.js";import{T as w}from"./index-BqhxRvg4.js";const fe={class:"header-section"},_e={key:0,class:"loading-container"},ge={key:1,class:"empty-state"},he={key:2,class:"error-state"},ve={key:3,class:"timetable-container"},Ie=V({__name:"TimetablePage",setup(Te){const O=localStorage.getItem("parisklegg_token")||"",C=localStorage.getItem("parisklegg_user");C&&JSON.parse(C);const P=$(),A=q(),g=Number(P.params.id),h=u(""),S=u(""),v=u(!0),I=u(!1),T=u(!1),k=u([]),F=()=>{const t=new Date,a=t.getDay()||7,n=new Date(t);n.setDate(t.getDate()-a+1);const d=new Date(n);d.setDate(n.getDate()+6);const r={month:"short",day:"numeric"};return"".concat(n.toLocaleDateString(void 0,r)," - ").concat(d.toLocaleDateString(void 0,r))},R=(t,a)=>!!t&&t.trim()!==""&&!!a&&a.trim()!=="",K=async()=>{try{v.value=!0,I.value=!1;const t=await N.post("https://klegg-app-whh7m.ondigitalocean.app/api/timetable",{tutorship_id:g},{headers:L(),timeout:2e4});console.log("Timetable response:",t.data),z(t.data)}catch(t){M(t),I.value=!0}finally{v.value=!1}},z=t=>{const a=[{name:"Monday",dayKey:"monday"},{name:"Tuesday",dayKey:"tuesday"},{name:"Wednesday",dayKey:"wednesday"},{name:"Thursday",dayKey:"thursday"},{name:"Friday",dayKey:"friday"},{name:"Saturday",dayKey:"saturday"},{name:"Sunday",dayKey:"sunday"}],n=new Date().getDay(),d=a[n===0?6:n-1].dayKey;k.value=[],T.value=!1,t.forEach(r=>{r.tutorship_id===g&&(h.value=r.tutorship_name||"My Timetable",a.forEach(c=>{const x=r["".concat(c.dayKey,"_start")],B=r["".concat(c.dayKey,"_end")];R(x,B)&&(T.value=!0,k.value.push({name:c.name,dayKey:c.dayKey,startTime:x,endTime:B,isToday:c.dayKey===d}))}))})},L=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(O)}),M=t=>{var a;if(console.error("Error fetching data:",t),N.isAxiosError(t)){if(((a=t.response)==null?void 0:a.status)===401){A.replace("/"),w.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(t.code==="ECONNABORTED"){w.show({text:"Request timeout. Please try again",position:"top"});return}}w.show({text:"Failed to load data. Please try again later",position:"top"})};return b.setOverlaysWebView({overlay:!1}),b.setBackgroundColor({color:"#ffffff"}),b.setStyle({style:W.Light}),H(()=>{S.value=F(),K(),console.log("Mounted: Fetching timetable for tutorship ID:",g)}),(t,a)=>(l(),f(e(j),null,{default:o(()=>[s(e(Y),null,{default:o(()=>[s(e(J),null,{default:o(()=>[s(e(G),{slot:"start"},{default:o(()=>[s(e(U),{"default-href":"/"})]),_:1}),s(e(X),null,{default:o(()=>a[0]||(a[0]=[i("Timetable",-1)])),_:1,__:[0]})]),_:1})]),_:1}),s(e(oe),{class:"ion-padding",fullscreen:!0},{default:o(()=>[y("div",fe,[h.value?(l(),f(e(_),{key:0,class:"title"},{default:o(()=>[i(p(h.value),1)]),_:1})):E("",!0),s(e(_),{class:"subtitle"},{default:o(()=>[i(p(S.value),1)]),_:1})]),v.value?(l(),m("div",_e,[s(e(Q),{name:"crescent",color:"primary"})])):T.value?I.value?(l(),m("div",he,[s(e(D),{icon:e(ee),color:"danger",size:"large"},null,8,["icon"]),s(e(_),null,{default:o(()=>a[2]||(a[2]=[y("h3",null,"Failed to load timetable",-1),y("p",null,"Please try again later",-1)])),_:1,__:[2]}),s(e(ae),{onClick:K,fill:"clear"},{default:o(()=>a[3]||(a[3]=[i("Retry",-1)])),_:1,__:[3]})])):(l(),m("div",ve,[(l(!0),m(te,null,se(k.value,(n,d)=>(l(),f(e(ne),{key:d,class:le(["day-card",{"today-card":n.isToday}])},{default:o(()=>[s(e(re),null,{default:o(()=>[s(e(ie),{class:"day-title"},{default:o(()=>[i(p(n.name)+" ",1),n.isToday?(l(),f(e(de),{key:0,color:"success"},{default:o(()=>a[4]||(a[4]=[i("Today",-1)])),_:1,__:[4]})):E("",!0)]),_:2},1024)]),_:2},1024),s(e(ue),{class:"time-content"},{default:o(()=>[s(e(ce),{lines:"none"},{default:o(()=>[s(e(D),{slot:"start",icon:e(ye),color:"primary"},null,8,["icon"]),s(e(me),null,{default:o(()=>[i(p(n.startTime)+" - "+p(n.endTime),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))])):(l(),m("div",ge,[s(e(D),{icon:e(Z),size:"large"},null,8,["icon"]),s(e(_),null,{default:o(()=>a[1]||(a[1]=[y("h3",null,"No Classes Scheduled",-1),y("p",null,"Your timetable will appear here when classes are scheduled",-1)])),_:1,__:[1]})]))]),_:1})]),_:1}))}}),De=pe(Ie,[["__scopeId","data-v-0cb64339"]]);export{De as default};
