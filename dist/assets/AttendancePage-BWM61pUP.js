import{d as J,ar as U,r as _,S as w,a as G,o as K,b as C,w as a,u as e,I as W,e as T,f as Y,g as t,h as Q,i as X,P as Z,l as ee,A as r,q as te,k as l,s as m,a9 as b,a3 as c,t as d,x as L,C as N,n as i,at as ae,au as ne,v as se,J as oe,a2 as le,m as re,a4 as ce,T as ie,U as ue,M as de,N as u,av as _e,a7 as me,$ as D,K as fe,aw as pe,ax as ge,ay as ve,az as he,aA as ye,aB as ke,aC as Ie,aD as we,aE as Ce,aF as be,aG as xe,F as Oe,_ as Se}from"./index-BmZ7d-Na.js";import{T as x}from"./index-BNufPZAv.js";const Ae={class:"header-section ion-padding"},Be={class:"summary-cards"},Te={class:"summary-content"},Le={class:"summary-content"},Ne={key:0,class:"loading-container"},De={key:1,class:"empty-state"},Ee={key:2,class:"error-state"},Pe={key:3},Re={class:"attendance-header"},Fe={class:"attendance-details"},Ve={class:"detail-row"},ze={class:"detail-row"},Me={key:0,class:"detail-row"},$e={key:1,class:"detail-row"},je={slot:"end",class:"attendance-icon"},qe=J({__name:"AttendancePage",setup(He){const E=localStorage.getItem("parisklegg_token")||"",O=localStorage.getItem("parisklegg_user"),g=O?JSON.parse(O):null,P=(g==null?void 0:g.user_id)||0,R=U(),F=Y(),V=Number(R.params.id),v=_(""),h=_(!0),f=_(!1),S=_(!1),y=_([]),k=_(0),I=_(0),A=n=>{switch(n==null?void 0:n.toLowerCase()){case"present":return"var(--ion-color-success)";case"absent":return"var(--ion-color-danger)";case"late":return"var(--ion-color-warning)";case"sick":return"var(--ion-color-primary)";default:return"var(--ion-color-medium)"}},z=n=>{switch(n==null?void 0:n.toLowerCase()){case"present":return Oe;case"absent":return xe;case"late":return be;case"sick":return Ce;default:return we}},M=n=>{switch(n==null?void 0:n.toLowerCase()){case"present":return"success";case"absent":return"danger";case"late":return"warning";case"sick":return"primary";default:return"medium"}},$=n=>new Date(n).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=async()=>{try{h.value=!0,f.value=!1,y.value=[],k.value=0,I.value=0;const o=(await T.get("https://klegg-app-whh7m.ondigitalocean.app/api/attendances",{headers:q(),timeout:2e4})).data.filter(s=>s.tutorship_id===V&&s.user_id===P);console.log("Filtered user attendance records:",o),o.length>0&&(S.value=!0,v.value=o[0].tutorship_name||"My Attendance",o.forEach(s=>{s.student_attendance.toLowerCase()==="present"?k.value++:s.student_attendance.toLowerCase()==="absent"&&I.value++}),y.value=o.sort((s,p)=>new Date(p.attendance_date||p.created_at).getTime()-new Date(s.attendance_date||s.created_at).getTime()))}catch(n){H(n),f.value=!0}finally{h.value=!1}},j=n=>{console.log("Reporting issue for record:",n)},q=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(E)}),H=n=>{var o;if(console.error("Error fetching data:",n),T.isAxiosError(n)){if(((o=n.response)==null?void 0:o.status)===401){F.replace("/"),x.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(n.code==="ECONNABORTED"){x.show({text:"Request timeout. Please try again",position:"top"});return}}x.show({text:"Failed to load data. Please try again later",position:"top"})};return w.setOverlaysWebView({overlay:!1}),w.setBackgroundColor({color:"#ffffff"}),w.setStyle({style:G.Light}),K(()=>{B()}),(n,o)=>(u(),C(e(W),null,{default:a(()=>[t(e(te),null,{default:a(()=>[t(e(Q),null,{default:a(()=>[t(e(X),{slot:"start"},{default:a(()=>[t(e(Z),{"default-href":"/"})]),_:1}),t(e(ee),null,{default:a(()=>[...o[0]||(o[0]=[r("Attendance",-1)])]),_:1})]),_:1})]),_:1}),t(e(de),{fullscreen:!0},{default:a(()=>[l("div",Ae,[v.value?(u(),C(e(c),{key:0,class:"title"},{default:a(()=>[r(d(v.value),1)]),_:1})):b("",!0),l("div",Be,[t(e(L),{class:"summary-card present"},{default:a(()=>[t(e(N),null,{default:a(()=>[l("div",Te,[t(e(i),{icon:e(ae),class:"summary-icon"},null,8,["icon"]),l("div",null,[t(e(c),{class:"summary-count"},{default:a(()=>[r(d(k.value),1)]),_:1}),t(e(c),{class:"summary-label"},{default:a(()=>[...o[1]||(o[1]=[r("Present",-1)])]),_:1})])])]),_:1})]),_:1}),t(e(L),{class:"summary-card absent"},{default:a(()=>[t(e(N),null,{default:a(()=>[l("div",Le,[t(e(i),{icon:e(ne),class:"summary-icon"},null,8,["icon"]),l("div",null,[t(e(c),{class:"summary-count"},{default:a(()=>[r(d(I.value),1)]),_:1}),t(e(c),{class:"summary-label"},{default:a(()=>[...o[2]||(o[2]=[r("Absent",-1)])]),_:1})])])]),_:1})]),_:1})])]),h.value?(u(),m("div",Ne,[t(e(se),{name:"crescent",color:"primary"})])):!S.value&&!f.value?(u(),m("div",De,[t(e(i),{icon:e(oe),color:"medium"},null,8,["icon"]),t(e(c),null,{default:a(()=>[...o[3]||(o[3]=[l("h3",null,"No Attendance Records",-1),l("p",null,"Your attendance will appear here when marked by your teacher",-1)])]),_:1})])):f.value?(u(),m("div",Ee,[t(e(i),{icon:e(le),color:"danger"},null,8,["icon"]),t(e(c),null,{default:a(()=>[...o[4]||(o[4]=[l("h3",null,"Error Loading Attendance",-1),l("p",null,"Please try again later",-1)])]),_:1}),t(e(re),{fill:"clear",onClick:B},{default:a(()=>[...o[5]||(o[5]=[r("Retry",-1)])]),_:1})])):(u(),m("div",Pe,[t(e(ce),{lines:"none"},{default:a(()=>[(u(!0),m(ie,null,ue(y.value,(s,p)=>(u(),C(e(_e),{key:p},{default:a(()=>[t(e(me),{class:"attendance-item",detail:!1},{default:a(()=>[l("div",{slot:"start",class:"status-indicator",style:D({backgroundColor:A(s.student_attendance)})},null,4),t(e(fe),{class:"attendance-content"},{default:a(()=>[l("div",Re,[t(e(c),{class:"attendance-status",style:D({color:A(s.student_attendance)})},{default:a(()=>[r(d(s.student_attendance),1)]),_:2},1032,["style"]),t(e(c),{class:"attendance-date bal-text-color"},{default:a(()=>[r(d($(s.attendance_date||s.created_at)),1)]),_:2},1024)]),l("div",Fe,[l("div",Ve,[t(e(i),{icon:e(pe)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:a(()=>[r(d(s.student_name),1)]),_:2},1024)]),l("div",ze,[t(e(i),{icon:e(ge)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:a(()=>[r(d(s.teacher_name),1)]),_:2},1024)]),s.attendance_code?(u(),m("div",Me,[t(e(i),{icon:e(ve)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:a(()=>[r("Code: "+d(s.attendance_code),1)]),_:2},1024)])):b("",!0),s.remark?(u(),m("div",$e,[t(e(i),{icon:e(he)},null,8,["icon"]),t(e(c),{class:"bal-text-color"},{default:a(()=>[r(d(s.remark),1)]),_:2},1024)])):b("",!0)])]),_:2},1024),l("div",je,[t(e(i),{icon:z(s.student_attendance),color:M(s.student_attendance)},null,8,["icon","color"])])]),_:2},1024),t(e(ye),{side:"end"},{default:a(()=>[t(e(ke),{color:"danger",onClick:Je=>j(s)},{default:a(()=>[t(e(i),{slot:"icon-only",icon:e(Ie)},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1}))}}),Ke=Se(qe,[["__scopeId","data-v-375c2bc6"]]);export{Ke as default};
