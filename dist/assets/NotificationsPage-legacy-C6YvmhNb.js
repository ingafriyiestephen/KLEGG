System.register(["./index-legacy-LZepmReL.js","./index-legacy-DduMCVS-.js"],function(a,e){"use strict";var t,o,i,n,l,r,c,d,s,u,p,g,m,f,v,h,x,y,_,b,w,k,z,N,S,j,C,E,I,L,O,A,P,T,R,B,D,q,H,U,$,F,J,K,M,V;return{setters:[a=>{t=a.d,o=a.r,i=a.O,n=a.o,l=a.b,r=a.w,c=a.u,d=a.I,s=a.e,u=a.f,p=a.S,g=a.a,m=a.g,f=a.h,v=a.l,h=a.A,x=a.q,y=a.s,_=a.k,b=a.v,w=a.n,k=a.a2,z=a.a3,N=a.m,S=a.E,j=a.a4,C=a.U,E=a.T,I=a.a5,L=a.a6,O=a.M,A=a.R,P=a.N,T=a.a7,R=a.X,B=a.j,D=a.a8,q=a.K,H=a.a9,U=a.t,$=a.aa,F=a.ab,J=a.ac,K=a.ad,M=a._},a=>{V=a.T}],execute:function(){var e=document.createElement("style");e.textContent=".loading-container[data-v-d9e300a7]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:60vh;text-align:center}.loading-container ion-spinner[data-v-d9e300a7]{width:48px;height:48px;margin-bottom:16px}.loading-container p[data-v-d9e300a7]{color:var(--ion-color-medium);margin-top:8px}.error-state[data-v-d9e300a7],.empty-state[data-v-d9e300a7]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;height:60vh;padding:20px}.error-state ion-icon[data-v-d9e300a7],.empty-state ion-icon[data-v-d9e300a7]{margin-bottom:16px}.error-state h3[data-v-d9e300a7],.empty-state h3[data-v-d9e300a7]{font-size:1.2rem;font-weight:500;margin-bottom:8px;color:var(--ion-color-dark)}.error-state p[data-v-d9e300a7],.empty-state p[data-v-d9e300a7]{font-size:.9rem;color:var(--ion-color-medium);margin-bottom:16px}.notification-item[data-v-d9e300a7]{--padding-start: 12px;--padding-end: 12px;--inner-padding-end: 12px;--border-color: var(--ion-color-light)}.notification-item.unread[data-v-d9e300a7]{--background: rgba(var(--ion-color-primary-rgb), .05)}.notification-avatar[data-v-d9e300a7]{width:48px;height:48px;margin-right:12px}.notification-item h2[data-v-d9e300a7]{font-size:1rem;font-weight:600;margin-bottom:4px}.preview-text[data-v-d9e300a7]{font-size:.9rem;color:var(--ion-color-medium);margin-bottom:8px;line-height:1.4}.notification-meta[data-v-d9e300a7]{display:flex;align-items:center;gap:8px;font-size:.8rem;color:var(--ion-color-medium)}.notification-meta ion-badge[data-v-d9e300a7]{font-size:.7rem;font-weight:500;padding:2px 6px}.date[data-v-d9e300a7]{flex:1}.reactions-row[data-v-d9e300a7]{display:flex;gap:4px;margin:8px 0;flex-wrap:wrap}.reactions-row ion-chip[data-v-d9e300a7]{display:inline-flex;flex-direction:row;align-items:center;justify-content:center;padding:0 8px;height:28px}.reactions-row ion-icon[data-v-d9e300a7]{margin-right:4px;font-size:16px}.reactions-row ion-label[data-v-d9e300a7]{font-size:12px;margin-left:0}.notification-meta[data-v-d9e300a7]{display:flex;align-items:center;gap:8px;margin-top:4px;font-size:.8rem;color:var(--ion-color-medium)}.comments-count[data-v-d9e300a7]{display:flex;align-items:center;gap:2px}.unread[data-v-d9e300a7]{--background: rgba(var(--ion-color-primary-rgb), .08)}\n",document.head.appendChild(e);const W={key:0,class:"loading-container"},X={key:1,class:"error-state"},Y={key:2,class:"empty-state"},G={class:"preview-text"},Q={key:0,class:"reactions-row"},Z={class:"notification-meta"},aa={class:"date"},ea={key:0,class:"comments-count"};a("default",M(t({__name:"NotificationsPage",setup(a){const e=localStorage.getItem("parisklegg_token")||"",t=localStorage.getItem("parisklegg_user");t&&JSON.parse(t);const M=a=>({like:K,heart:J,"thumbs-up":F}[a]||K),ta=u(),oa=o(!0),ia=o(!1),na=o(!1),la=o([]),ra=o(1),ca=o(!0),da=async(a=1)=>{try{if(1===a?(oa.value=!0,la.value=[]):ia.value=!0,na.value=!1,!e)throw new Error("No authentication token found");const t=await s.get("https://school.klgilc.com/api/notifications",{headers:sa(),timeout:1e4,params:{page:a}});la.value=1===a?t.data.data:[...la.value,...t.data.data],ra.value=a,ca.value=!!t.data.next_page_url,console.log("Notifications fetched successfully:",la.value)}catch(t){ua(t),na.value=!0}finally{oa.value=!1,ia.value=!1}};i(async()=>{await da()});const sa=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${e}`}),ua=a=>{if(console.error("Error fetching data:",a),s.isAxiosError(a)){var e;if(401===(null===(e=a.response)||void 0===e?void 0:e.status))return ta.replace("/"),void V.show({text:"Session expired. Please login again",position:"top",duration:"long"});if("ECONNABORTED"===a.code)return void V.show({text:"Request timeout. Please try again",position:"top"})}p.setOverlaysWebView({overlay:!1}),p.setBackgroundColor({color:"#ffffff"}),p.setStyle({style:g.Light}),V.show({text:"Failed to load data. Please try again later",position:"top"})};return n(()=>{da()}),(a,e)=>{const t=A("ion-chip");return P(),l(c(d),null,{default:r(()=>[m(c(x),null,{default:r(()=>[m(c(f),null,{default:r(()=>[m(c(v),null,{default:r(()=>e[2]||(e[2]=[h("Notifications",-1)])),_:1,__:[2]})]),_:1})]),_:1}),m(c(O),{fullscreen:!0,onIonScroll:e[1]||(e[1]=a=>(a=>{const e=a.target;if(!e)return;const t=e.scrollHeight;e.scrollTop+e.clientHeight>.8*t&&ca.value&&!ia.value&&da(ra.value+1)})(a))},{default:r(()=>[oa.value&&!ia.value?(P(),y("div",W,[m(c(b),{name:"crescent",color:"primary"}),e[3]||(e[3]=_("p",null,"Loading notifications...",-1))])):na.value?(P(),y("div",X,[m(c(w),{icon:c(k),color:"danger",size:"large"},null,8,["icon"]),m(c(z),null,{default:r(()=>e[4]||(e[4]=[_("h3",null,"Error Loading Notifications",-1),_("p",null,"Please try again later",-1)])),_:1,__:[4]}),m(c(N),{fill:"clear",onClick:da},{default:r(()=>e[5]||(e[5]=[h("Retry",-1)])),_:1,__:[5]})])):0!==la.value.length||oa.value?(P(),l(c(j),{key:3},{default:r(()=>[(P(!0),y(E,null,C(la.value,a=>(P(),l(c(T),{key:a.id,onClick:e=>{return t=a.id,void ta.push(`/notifications/${t}`);var t},class:R(["notification-item",{unread:!a.is_read}])},{default:r(()=>[m(c(B),{slot:"start",class:"notification-avatar"},{default:r(()=>e[7]||(e[7]=[_("img",{src:D,alt:"School Logo"},null,-1)])),_:1,__:[7]}),m(c(q),null,{default:r(()=>{return[_("h2",null,U(a.title),1),_("p",G,U((o=a.body,i=60,o.length<=i?o:o.substring(0,i)+"...")),1),a.reaction_counts&&Object.keys(a.reaction_counts).length?(P(),y("div",Q,[(P(!0),y(E,null,C(a.reaction_counts,(a,e)=>(P(),l(t,{key:e,color:"light",class:"reaction-chip"},{default:r(()=>[m(c(w),{icon:M(e)},null,8,["icon"]),m(c(q),null,{default:r(()=>[h(U(a),1)]),_:2},1024)]),_:2},1024))),128))])):H("",!0),_("div",Z,[_("span",aa,U((e=a.created_at,new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}))),1),a.comments_count?(P(),y("span",ea,[m(c(w),{icon:c($)},null,8,["icon"]),h(" "+U(a.comments_count),1)])):H("",!0)])];var e,o,i}),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})):(P(),y("div",Y,[m(c(w),{icon:c(S),color:"medium",size:"large"},null,8,["icon"]),m(c(z),null,{default:r(()=>e[6]||(e[6]=[_("h3",null,"No Notifications",-1),_("p",null,"You don't have any notifications yet",-1)])),_:1,__:[6]})])),m(c(I),{onIonInfinite:e[0]||(e[0]=a=>(async a=>{await da(ra.value+1),a.target.complete()})(a)),threshold:"100px",disabled:!ca.value},{default:r(()=>[m(c(L),{"loading-spinner":"bubbles","loading-text":"Loading more notifications..."})]),_:1},8,["disabled"])]),_:1})]),_:1})}}}),[["__scopeId","data-v-d9e300a7"]]))}}});
