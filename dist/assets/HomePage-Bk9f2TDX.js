import{d as W,r as C,c as _,o as X,a as Z,w as o,u as t,I as tt,i as P,b as D,e as et,f as nt,g as a,h as at,j as H,k as ot,l as s,m as st,t as c,n as L,p as i,q as lt,s as it,v as f,x as rt,y as b,z as N,A as x,B as l,C as M,D as A,E as q,F as ct,G as dt,H as ut,J as ft,K as pt,L as gt,M as _t,N as mt,O as u,_ as vt}from"./index-D6yZBIDx.js";import{T as m}from"./index-D-N4iO5a.js";const ht=["src"],yt={class:"greeting"},kt={class:"student-name"},wt={key:0,class:"loading-container"},Tt={key:1},It={key:0,class:"notification-content"},Ct={key:1,class:"empty-state"},Dt={key:0,class:"attendance-content"},bt={key:1,class:"empty-state"},Nt={class:"quick-actions-grid"},xt={class:"action-icon-wrapper"},At={class:"action-icon-wrapper"},Ot={class:"action-icon-wrapper"},St=W({__name:"HomePage",setup(Bt){const z=localStorage.getItem("parisklegg_token")||"",O=localStorage.getItem("parisklegg_user"),k=O?JSON.parse(O):null,G=(k==null?void 0:k.fullname)||"",v=et(),h=C(!0),p=C([]),d=C([]),V=_(()=>{const n=new Date().getHours();return n<12?"Good Morning":n<18?"Good Afternoon":"Good Evening"}),w=_(()=>p.value.length>0?p.value[0]:null),g=_(()=>{if(d.value.length>0){const e=[...d.value].sort((r,I)=>new Date(I.created_at).getTime()-new Date(r.created_at).getTime())[0];return console.log("Latest attendance:",e),e}return console.log("No attendances available"),null});_(()=>{try{return d.value&&d.value.length>0?[...d.value].sort((e,r)=>new Date(r.created_at).getTime()-new Date(e.created_at).getTime())[0]:null}catch(n){return console.error("Error processing attendance data:",n),null}});const j=_(()=>"/assets/img/login-logo.png"),F=()=>{const n=document.body;n.classList.remove("ios","android"),P("ios")?n.classList.add("ios"):P("android")&&n.classList.add("android")},T=n=>{if(!n)return"Recently";const e=new Date(n),I=Math.abs(new Date().getTime()-e.getTime()),y=Math.floor(I/(1e3*60*60*24));return y===0?"Today":y===1?"Yesterday":y<7?"".concat(y," days ago"):e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},J=(n,e)=>n?n.length>e?n.substring(0,e)+"...":n:"",U=()=>v.push("/tutorships"),S=()=>v.push("/notifications"),Y=()=>v.push("/settings"),$=async()=>{h.value=!0;try{await B(),await m.show({text:"Data refreshed",position:"top"})}catch(n){console.error("Refresh error:",n),await m.show({text:"Refresh failed",position:"top"})}finally{h.value=!1}},B=async()=>{try{const[n,e]=await Promise.all([D.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications",{headers:E()}),D.get("https://klegg-app-whh7m.ondigitalocean.app/api/attendances",{headers:E()})]);p.value=n.data.data||[],d.value=e.data||[],console.log("Notifications loaded:",p.value),console.log("Attendances loaded:",d.value)}catch(n){K(n)}},E=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(z)}),K=n=>{var e;if(console.error("Error fetching data:",n),D.isAxiosError(n)){if(((e=n.response)==null?void 0:e.status)===401){v.replace("/"),m.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(n.code==="ECONNABORTED"){m.show({text:"Request timeout. Please try again",position:"top"});return}}m.show({text:"Failed to load data. Please try again later",position:"top"})},R=n=>{const e=n.matches;nt(e)},Q=()=>{const n=window.matchMedia("(prefers-color-scheme: dark)");return R(n),n.addEventListener("change",R),n};return X(async()=>{try{F(),Q(),await B()}catch(n){console.error("Initialization error:",n)}finally{h.value=!1}}),(n,e)=>{const r=gt("ion-text");return u(),Z(t(tt),null,{default:o(()=>[a(t(it),{class:"ion-no-border"},{default:o(()=>[a(t(at),null,{default:o(()=>[a(t(H),{slot:"start"},{default:o(()=>[a(t(ot),{class:"toolbar-avatar"},{default:o(()=>[s("img",{src:j.value,alt:"Student"},null,8,ht)]),_:1})]),_:1}),a(t(st),{class:"toolbar-title"},{default:o(()=>[s("div",yt,c(V.value),1),s("div",kt,c(t(G)),1)]),_:1}),a(t(H),{slot:"end"},{default:o(()=>[a(t(L),{onClick:$,fill:"clear"},{default:o(()=>[a(t(i),{icon:t(lt),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),a(t(mt),{fullscreen:!0},{default:o(()=>[h.value?(u(),f("div",wt,[a(t(rt),{name:"crescent"}),e[0]||(e[0]=s("p",null,"Loading your data...",-1))])):(u(),f("div",Tt,[a(t(b),{class:"content-card"},{default:o(()=>[a(t(N),null,{default:o(()=>[a(t(x),null,{default:o(()=>[a(t(i),{icon:t(M)},null,8,["icon"]),e[1]||(e[1]=l(" Recent Updates ",-1))]),_:1})]),_:1}),a(t(A),null,{default:o(()=>[w.value?(u(),f("div",It,[s("p",null,c(J(w.value.body,100)),1),a(t(q),null,{default:o(()=>[l(c(T(w.value.created_at)),1)]),_:1})])):(u(),f("div",Ct,[a(t(i),{icon:t(ct)},null,8,["icon"]),e[2]||(e[2]=s("p",null,"No recent updates",-1))])),a(t(L),{expand:"block",fill:"clear",size:"small",onClick:S,class:"view-all-button"},{default:o(()=>[l(" View All Notifications ("+c(p.value.length)+") ",1)]),_:1})]),_:1})]),_:1}),a(t(b),{class:"content-card"},{default:o(()=>[a(t(N),null,{default:o(()=>[a(t(x),null,{default:o(()=>[a(t(i),{icon:t(dt)},null,8,["icon"]),e[3]||(e[3]=l(" Recent Attendance ",-1))]),_:1})]),_:1}),a(t(A),null,{default:o(()=>[g.value?(u(),f("div",Dt,[s("p",null,[e[4]||(e[4]=l(" You were marked ",-1)),s("strong",null,c(g.value.student_attendance),1),e[5]||(e[5]=l(" in ",-1)),s("strong",null,c(g.value.tutorship_name),1)]),a(t(q),null,{default:o(()=>[l(c(T(g.value.attendance_date)||T(g.value.created_at)),1)]),_:1})])):(u(),f("div",bt,[a(t(i),{icon:t(ut)},null,8,["icon"]),e[6]||(e[6]=s("p",null,"No attendance records yet",-1))]))]),_:1})]),_:1}),a(t(b),{class:"content-card"},{default:o(()=>[a(t(N),null,{default:o(()=>[a(t(x),null,{default:o(()=>[a(t(i),{icon:t(ft)},null,8,["icon"]),e[7]||(e[7]=l(" Quick Actions ",-1))]),_:1})]),_:1}),a(t(A),{class:"quick-actions-container"},{default:o(()=>[s("div",Nt,[s("div",{class:"action-item",onClick:U},[s("div",xt,[a(t(i),{icon:t(pt),class:"action-icon"},null,8,["icon"])]),a(r,{class:"action-label"},{default:o(()=>[...e[8]||(e[8]=[l("Classes",-1)])]),_:1})]),s("div",{class:"action-item",onClick:S},[s("div",At,[a(t(i),{icon:t(M),class:"action-icon"},null,8,["icon"])]),a(r,{class:"action-label"},{default:o(()=>[...e[9]||(e[9]=[l("Notifications",-1)])]),_:1})]),s("div",{class:"action-item",onClick:Y},[s("div",Ot,[a(t(i),{icon:t(_t),class:"action-icon"},null,8,["icon"])]),a(r,{class:"action-label"},{default:o(()=>[...e[10]||(e[10]=[l("Settings",-1)])]),_:1})])])]),_:1})]),_:1})]))]),_:1})]),_:1})}}}),Pt=vt(St,[["__scopeId","data-v-cba0468d"]]);export{Pt as default};
