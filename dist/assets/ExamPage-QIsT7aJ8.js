import{d as Y,ao as G,r as v,c as g,o as J,O as $,a as C,w as s,u as e,I as K,b,e as Q,f as U,g as t,h as X,i as Z,P as ee,l as ae,A as o,q as te,s as c,x as S,y as T,z as B,n as y,aO as se,C as D,k as u,a3 as n,t as i,W as N,v as le,ay as oe,a2 as ne,m as re,a9 as R,M as ue,N as d,_ as ie}from"./index-CbFFUppU.js";import{T as x}from"./index-HY87JrIe.js";const de={class:"summary-item"},ce={class:"summary-item"},me={key:0,class:"loading-container"},fe={key:1,class:"empty-state"},pe={key:2,class:"error-state"},_e={class:"detail-row"},ve={class:"detail-row"},ge={key:0,class:"detail-row"},ye={key:1,class:"feedback-section"},xe=Y({__name:"ExamPage",setup(he){const P=localStorage.getItem("parisklegg_token")||"",h=localStorage.getItem("parisklegg_user"),p=h?JSON.parse(h):null,O=(p==null?void 0:p.user_id)||0,A=Q(),z=G(),V=Number(z.params.id),_=v(!0),m=v(!1),r=v({student_id:0,tutorship_id:0,score_numerator:0,score_denominator:0}),M=g(()=>r.value!==null),F=g(()=>{var l;return((l=r.value)==null?void 0:l.tutorship_name)||"Exam"}),f=g(()=>r.value?H(r.value.score_numerator,r.value.score_denominator):0),H=(l,a)=>a===0?0:Math.round(l/a*100),k=l=>l>=85?"excellent":l>=70?"good":l>=50?"average":"poor",L=l=>{const a=new Date(l),W={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1};return a.toLocaleDateString(void 0,W)},I=async()=>{try{_.value=!0,m.value=!1,r.value={student_id:0,tutorship_id:0,score_numerator:0,score_denominator:0};const l=await b.post("https://klegg-app-whh7m.ondigitalocean.app/api/exams",{tutorship_id:V,student_id:O},{headers:j(),timeout:2e4});l.data.length>0&&(r.value=l.data[0])}catch(l){console.error("Error fetching exam results:",l),q(l),m.value=!0}finally{_.value=!1}},j=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(P)}),q=l=>{var a;if(console.error("Error fetching data:",l),b.isAxiosError(l)){if(((a=l.response)==null?void 0:a.status)===401){A.replace("/"),x.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(l.code==="ECONNABORTED"){x.show({text:"Request timeout. Please try again",position:"top"});return}}x.show({text:"Failed to load data. Please try again later",position:"top"})},E=l=>{const a=l.matches;U(a)},w=()=>{const l=window.matchMedia("(prefers-color-scheme: dark)");return E(l),l.addEventListener("change",E),l};return J(()=>{w(),I()}),$(()=>{w()}),(l,a)=>(d(),C(e(K),null,{default:s(()=>[t(e(te),null,{default:s(()=>[t(e(X),null,{default:s(()=>[t(e(Z),{slot:"start"},{default:s(()=>[t(e(ee),{"default-href":"/"})]),_:1}),t(e(ae),null,{default:s(()=>[...a[0]||(a[0]=[o("Exam Results",-1)])]),_:1})]),_:1})]),_:1}),t(e(ue),{fullscreen:!0},{default:s(()=>[t(e(S),{class:"summary-card"},{default:s(()=>[t(e(T),null,{default:s(()=>[t(e(B),{class:"summary-title"},{default:s(()=>[t(e(y),{icon:e(se),color:"primary"},null,8,["icon"]),a[1]||(a[1]=o(" Exam Overview ",-1))]),_:1})]),_:1}),t(e(D),{class:"summary-content"},{default:s(()=>[u("div",de,[t(e(n),{class:"summary-label"},{default:s(()=>[...a[2]||(a[2]=[o("Exam",-1)])]),_:1}),t(e(n),{class:"summary-value"},{default:s(()=>[o(i(F.value),1)]),_:1})]),a[4]||(a[4]=u("div",{class:"divider"},null,-1)),u("div",ce,[t(e(n),{class:"summary-label"},{default:s(()=>[...a[3]||(a[3]=[o("Your Score",-1)])]),_:1}),t(e(n),{class:N(["summary-value",k(f.value)])},{default:s(()=>[o(i(f.value)+"% ",1)]),_:1},8,["class"])])]),_:1})]),_:1}),_.value?(d(),c("div",me,[t(e(le),{name:"crescent",color:"primary"})])):!M.value&&!m.value?(d(),c("div",fe,[t(e(y),{icon:e(oe),size:"large",color:"medium"},null,8,["icon"]),t(e(n),null,{default:s(()=>[...a[5]||(a[5]=[u("h3",null,"No Exam Results",-1),u("p",null,"Your exam results will appear here once available",-1)])]),_:1})])):m.value?(d(),c("div",pe,[t(e(y),{icon:e(ne),size:"large",color:"danger"},null,8,["icon"]),t(e(n),null,{default:s(()=>[...a[6]||(a[6]=[u("h3",null,"Error Loading Results",-1),u("p",null,"Please try again later",-1)])]),_:1}),t(e(re),{fill:"clear",onClick:I},{default:s(()=>[...a[7]||(a[7]=[o("Retry",-1)])]),_:1})])):(d(),C(e(S),{key:3,class:"details-card"},{default:s(()=>[t(e(T),null,{default:s(()=>[t(e(B),null,{default:s(()=>[...a[8]||(a[8]=[o("Detailed Results",-1)])]),_:1})]),_:1}),t(e(D),null,{default:s(()=>[u("div",_e,[t(e(n),{class:"detail-label"},{default:s(()=>[...a[9]||(a[9]=[o("Score",-1)])]),_:1}),t(e(n),{class:"detail-value"},{default:s(()=>[o(i(r.value.score_numerator)+"/"+i(r.value.score_denominator),1)]),_:1})]),u("div",ve,[t(e(n),{class:"detail-label"},{default:s(()=>[...a[10]||(a[10]=[o("Percentage",-1)])]),_:1}),t(e(n),{class:N(["detail-value",k(f.value)])},{default:s(()=>[o(i(f.value)+"% ",1)]),_:1},8,["class"])]),r.value.created_at?(d(),c("div",ge,[t(e(n),{class:"detail-label"},{default:s(()=>[...a[11]||(a[11]=[o("Date Taken",-1)])]),_:1}),t(e(n),{class:"detail-value"},{default:s(()=>[o(i(L(r.value.created_at)),1)]),_:1})])):R("",!0),r.value.comments?(d(),c("div",ye,[t(e(n),{class:"feedback-title"},{default:s(()=>[...a[12]||(a[12]=[o("Instructor Feedback",-1)])]),_:1}),t(e(n),{class:"feedback-content"},{default:s(()=>[o(i(r.value.comments),1)]),_:1})])):R("",!0)]),_:1})]),_:1}))]),_:1})]),_:1}))}}),Ee=ie(xe,[["__scopeId","data-v-a89ee625"]]);export{Ee as default};
