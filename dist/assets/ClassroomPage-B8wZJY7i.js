import{d as ce,ao as me,r as p,o as de,P as ge,ap as fe,a as T,w as i,u as n,I as pe,b as A,e as we,f as he,g as a,h as _e,j as Te,aq as ke,m as De,B as u,s as ve,l as w,v as m,a9 as h,a2 as g,t as d,x as Ce,p as v,K as Ie,a1 as be,n as V,R as Je,S as Me,N as Se,L as Ee,O as r,y as Le,V as Be,z as xe,A as Ne,ar as Ke,D as Pe,a6 as $e,H as C,a8 as Oe,as as je,_ as ze}from"./index-D6yZBIDx.js";import{T as _}from"./index-D-N4iO5a.js";const Fe={class:"header-section"},Re={key:0,class:"loading-container"},Ae={key:1,class:"empty-state"},Ve={key:2,class:"error-state"},He={key:3,class:"timetable-container"},We={key:0,class:"join-section"},qe={key:0,class:"no-link-message"},Ue={key:1,class:"countdown"},Ye={key:2,class:"status-message"},Ge={key:1,class:"not-today-message"},Qe=ce({__name:"ClassroomPage",setup(Xe){const H=localStorage.getItem("parisklegg_token")||"",E=localStorage.getItem("parisklegg_user");E&&JSON.parse(E);const W=me(),q=we(),L=Number(W.params.id),k=p(""),B=p(""),I=p(!0),b=p(!1),J=p(!1),D=p([]);let f=null;const U=()=>{const e=new Date,t=e.getDay()||7,o=new Date(e);o.setDate(e.getDate()-t+1);const s=new Date(o);s.setDate(o.getDate()+6);const l={month:"short",day:"numeric"};return"".concat(o.toLocaleDateString(void 0,l)," - ").concat(s.toLocaleDateString(void 0,l))},Y=e=>e.classEnded?"Class Ended":e.classInProgress?e.meetingLink?"Join Now":"No Link":e.canJoin?e.meetingLink?"Join Soon":"No Link":"Join Soon",G=e=>e.classEnded?"medium":e.classInProgress?"success":e.canJoin?"primary":"medium",Q=e=>e.classEnded?"outline":e.classInProgress||e.canJoin?"solid":"outline",X=e=>e.classEnded?C:e.classInProgress?je:e.canJoin?C:C,Z=(e,t)=>!!e&&e.trim()!==""&&!!t&&t.trim()!=="",x=e=>{const[t,o]=e.split(":").map(Number),s=new Date;return s.setHours(t,o,0,0),s},N=(e,t)=>{const o=new Date;return o>=e&&o<t},K=e=>new Date>=e,P=e=>{const t=new Date,o=new Date(e.getTime()-10*60*1e3);if(t<o){const s=o.getTime()-t.getTime(),l=Math.floor(s/(1e3*60*60)),c=Math.floor(s%(1e3*60*60)/(1e3*60));return l>0?"".concat(l,"h ").concat(c,"m"):"".concat(c,"m")}return""},y=()=>{D.value.forEach(e=>{if(e.isToday&&e.startDateTime&&e.endDateTime){const t=new Date,o=new Date(e.startDateTime.getTime()-10*60*1e3);e.canJoin=!1,e.statusMessage="",e.statusColor="medium",t<o?(e.countdown=P(e.startDateTime),e.statusMessage="Join available at ".concat($(o))):t>=o&&t<e.startDateTime?(e.canJoin=!0,e.countdown="",e.statusMessage="Join now to enter class",e.statusColor="success"):N(e.startDateTime,e.endDateTime)?(e.canJoin=!0,e.countdown="",e.statusMessage="Class in progress - Join now",e.statusColor="warning"):K(e.endDateTime)&&(e.countdown="",e.statusMessage="Class has ended",e.statusColor="danger")}})},$=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),O=async()=>{try{I.value=!0,b.value=!1;const e=await A.post("https://klegg-app-whh7m.ondigitalocean.app/api/timetable",{tutorship_id:L},{headers:oe(),timeout:2e4});console.log("Timetable response:",e.data),ee(e.data)}catch(e){ae(e),b.value=!0}finally{I.value=!1}},ee=e=>{const t=[{name:"Monday",dayKey:"monday"},{name:"Tuesday",dayKey:"tuesday"},{name:"Wednesday",dayKey:"wednesday"},{name:"Thursday",dayKey:"thursday"},{name:"Friday",dayKey:"friday"},{name:"Saturday",dayKey:"saturday"},{name:"Sunday",dayKey:"sunday"}],o=new Date().getDay(),s=t[o===0?6:o-1].dayKey;D.value=[],J.value=!1,e.forEach(l=>{l.tutorship_id===L&&(k.value=l.tutorship_name||"My Timetable",t.forEach(c=>{const M=l["".concat(c.dayKey,"_start")],S=l["".concat(c.dayKey,"_end")],ie=l["".concat(c.dayKey,"_course")];if(Z(M,S)){J.value=!0;const re=x(M),le=x(S),F=c.dayKey===s,ue=l["".concat(c.dayKey,"_meeting_link")],R={name:c.name,dayKey:c.dayKey,courseName:ie,startTime:M,endTime:S,isToday:F,canJoin:!1,classInProgress:!1,classEnded:!1,startDateTime:re,endDateTime:le,meetingLink:ue};F&&te(R),D.value.push(R)}}))}),se()},te=e=>{if(!e.startDateTime||!e.endDateTime)return;const t=new Date,o=new Date(e.startDateTime.getTime()-10*60*1e3);e.canJoin=!1,e.classInProgress=!1,e.classEnded=!1,e.countdown="",e.statusMessage="",e.statusColor="medium",t<o?(e.countdown=P(e.startDateTime),e.statusMessage="Join available at ".concat($(o)),e.statusColor="medium"):t>=o&&t<e.startDateTime?(e.canJoin=!0,e.statusMessage="Class starting soon - Join now",e.statusColor="success"):N(e.startDateTime,e.endDateTime)?(e.canJoin=!0,e.classInProgress=!0,e.statusMessage="Class in progress",e.statusColor="warning"):K(e.endDateTime)&&(e.classEnded=!0,e.statusMessage="Class has ended",e.statusColor="danger")},se=()=>{f&&clearInterval(f),f=window.setInterval(()=>{y()},6e4)},ne=async e=>{if(!e.canJoin||!e.meetingLink){e.meetingLink||_.show({text:"Meeting link not available for this class",position:"top",duration:"short"});return}try{if(_.show({text:"Opening ".concat(k.value," class..."),position:"top",duration:"short"}),e.meetingLink.includes("zoom.us")){const t=e.meetingLink.replace("/j/","/join/");window.open(t,"_system")}else e.meetingLink.includes("meet.google.com")?window.open(e.meetingLink,"_system"):window.open(e.meetingLink,"_blank")}catch(t){console.error("Error joining class:",t),_.show({text:"Failed to open meeting link",position:"top",duration:"short"})}},oe=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(H)}),ae=e=>{var t;if(console.error("Error fetching data:",e),A.isAxiosError(e)){if(((t=e.response)==null?void 0:t.status)===401){q.replace("/"),_.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(e.code==="ECONNABORTED"){_.show({text:"Request timeout. Please try again",position:"top"});return}}_.show({text:"Failed to load data. Please try again later",position:"top"})},j=e=>{const t=e.matches;he(t)},z=()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");return j(e),e.addEventListener("change",j),e};return de(()=>{z(),B.value=U(),O()}),ge(async()=>{z()}),fe(()=>{f&&(clearInterval(f),f=null)}),(e,t)=>{const o=Ee("ion-card-subtitle");return r(),T(n(pe),null,{default:i(()=>[a(n(ve),null,{default:i(()=>[a(n(_e),null,{default:i(()=>[a(n(Te),{slot:"start"},{default:i(()=>[a(n(ke),{"default-href":"/"})]),_:1}),a(n(De),null,{default:i(()=>[...t[0]||(t[0]=[u("Classroom",-1)])]),_:1})]),_:1})]),_:1}),a(n(Se),{class:"ion-padding",fullscreen:!0},{default:i(()=>[w("div",Fe,[k.value?(r(),T(n(g),{key:0,class:"title"},{default:i(()=>[u(d(k.value),1)]),_:1})):h("",!0),a(n(g),{class:"subtitle"},{default:i(()=>[u(d(B.value),1)]),_:1})]),I.value?(r(),m("div",Re,[a(n(Ce),{name:"crescent",color:"primary"})])):J.value?b.value?(r(),m("div",Ve,[a(n(v),{icon:n(be),color:"danger",size:"large"},null,8,["icon"]),a(n(g),null,{default:i(()=>[...t[2]||(t[2]=[w("h3",null,"Failed to load timetable",-1),w("p",null,"Please try again later",-1)])]),_:1}),a(n(V),{onClick:O,fill:"clear"},{default:i(()=>[...t[3]||(t[3]=[u("Retry",-1)])]),_:1})])):(r(),m("div",He,[(r(!0),m(Je,null,Me(D.value,(s,l)=>(r(),T(n(Le),{key:l,class:Be(["day-card",{"today-card":s.isToday}])},{default:i(()=>[a(n(xe),null,{default:i(()=>[a(n(Ne),{class:"day-title"},{default:i(()=>[u(d(s.name)+" ",1),s.isToday?(r(),T(n(Ke),{key:0,color:"success"},{default:i(()=>[...t[4]||(t[4]=[u("Today",-1)])]),_:1})):h("",!0)]),_:2},1024),s.courseName&&s.courseName!=="-"?(r(),T(o,{key:0,class:"course-name"},{default:i(()=>[u(d(s.courseName),1)]),_:2},1024)):h("",!0)]),_:2},1024),a(n(Pe),{class:"time-content"},{default:i(()=>[a(n($e),{lines:"none"},{default:i(()=>[a(n(v),{slot:"start",icon:n(C),color:"primary"},null,8,["icon"]),a(n(Oe),null,{default:i(()=>[u(d(s.startTime)+" - "+d(s.endTime),1)]),_:2},1024)]),_:2},1024),s.isToday?(r(),m("div",We,[a(n(V),{class:"join-button",disabled:!s.canJoin||!s.meetingLink,fill:Q(s),color:G(s),onClick:c=>ne(s),expand:"block"},{default:i(()=>[a(n(v),{slot:"start",icon:X(s)},null,8,["icon"]),u(" "+d(Y(s)),1)]),_:2},1032,["disabled","fill","color","onClick"]),!s.meetingLink&&s.canJoin?(r(),m("div",qe,[a(n(g),{color:"danger"},{default:i(()=>[...t[5]||(t[5]=[w("small",null,"Meeting link not available",-1)])]),_:1})])):h("",!0),s.countdown&&!s.canJoin&&!s.classInProgress?(r(),m("div",Ue,[a(n(g),{color:"medium"},{default:i(()=>[u(" Starts in "+d(s.countdown),1)]),_:2},1024)])):h("",!0),s.statusMessage?(r(),m("div",Ye,[a(n(g),{color:s.statusColor},{default:i(()=>[u(d(s.statusMessage),1)]),_:2},1032,["color"])])):h("",!0)])):(r(),m("div",Ge,[a(n(g),{color:"medium"},{default:i(()=>[u(" Join link will be available on "+d(s.name),1)]),_:2},1024)]))]),_:2},1024)]),_:2},1032,["class"]))),128))])):(r(),m("div",Ae,[a(n(v),{icon:n(Ie),size:"large"},null,8,["icon"]),a(n(g),null,{default:i(()=>[...t[1]||(t[1]=[w("h3",null,"No Classes Scheduled",-1),w("p",null,"Your timetable will appear here when classes are scheduled",-1)])]),_:1})]))]),_:1})]),_:1})}}}),et=ze(Qe,[["__scopeId","data-v-7e901d31"]]);export{et as default};
