import{d as U,r as m,c as h,S as C,a as W,o as X,b as Z,w as n,u as t,I as tt,e as S,f as et,g as e,h as at,i as H,j as nt,k as s,l as ot,t as u,m as f,n as i,p as st,q as lt,s as d,v as it,x as T,y as N,z as D,A as l,B as P,C as A,D as q,E as rt,F as ct,G as ut,H as dt,J as ft,K as O,L as gt,M as pt,N as r,_ as _t}from"./index-CKBFjtUw.js";import{T as g}from"./index-C0PW9qWZ.js";const vt=["src"],mt={class:"greeting"},ht={class:"student-name"},kt={key:0,class:"loading-container"},yt={key:1},wt={key:0,class:"notification-content"},It={key:1,class:"empty-state"},bt={key:0,class:"attendance-content"},Ct={key:1,class:"empty-state"},St={class:"quick-actions-grid"},Tt={class:"action-icon"},Nt={class:"action-icon"},Dt={class:"action-icon"},At=U({__name:"HomePage",setup(Ot){const V=localStorage.getItem("parisklegg_token")||"",x=localStorage.getItem("parisklegg_user"),k=x?JSON.parse(x):null,z=(k==null?void 0:k.fullname)||"",p=et(),_=m(!0),y=m([]),w=m([]),G=h(()=>{const o=new Date().getHours();return o<12?"Good Morning":o<18?"Good Afternoon":"Good Evening"}),I=h(()=>y.value.length>0?y.value[0]:null),b=h(()=>w.value.length>0?w.value[0]:null),j=h(()=>"/assets/img/login-logo.png"),B=o=>{const a=new Date(o),Q=Math.abs(new Date().getTime()-a.getTime()),v=Math.floor(Q/(1e3*60*60*24));return v===0?"Today":v===1?"Yesterday":v<7?"".concat(v," days ago"):a.toLocaleDateString()},F=(o,a)=>o?o.length>a?o.substring(0,a)+"...":o:"",J=()=>p.push("/tutorships"),E=()=>p.push("/notifications"),Y=()=>p.push("/settings"),$=async()=>{_.value=!0;try{await R(),await g.show({text:"Data refreshed",position:"top"})}catch(o){console.error("Refresh error:",o),await g.show({text:"Refresh failed",position:"top"})}finally{_.value=!1}},R=async()=>{try{const[o,a]=await Promise.all([S.get("https://klegg-app-whh7m.ondigitalocean.app/api/notifications",{headers:L()}),S.get("https://klegg-app-whh7m.ondigitalocean.app/api/attendances",{headers:L()})]);y.value=o.data,w.value=a.data}catch(o){K(o)}},L=()=>({"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(V)}),K=o=>{var a;if(console.error("Error fetching data:",o),S.isAxiosError(o)){if(((a=o.response)==null?void 0:a.status)===401){p.replace("/"),g.show({text:"Session expired. Please login again",position:"top",duration:"long"});return}if(o.code==="ECONNABORTED"){g.show({text:"Request timeout. Please try again",position:"top"});return}}g.show({text:"Failed to load data. Please try again later",position:"top"})};C.setOverlaysWebView({overlay:!1}),C.setBackgroundColor({color:"#ffffff"}),C.setStyle({style:W.Light});const c=m(!1);return X(async()=>{const o=localStorage.getItem("darkMode");try{if(o!==null)c.value=o==="true",document.body.classList.toggle("dark",c.value);else{const a=window.matchMedia("(prefers-color-scheme: dark)");c.value=a.matches,document.body.classList.toggle("dark",c.value),a.addEventListener("change",M=>{c.value=M.matches,document.body.classList.toggle("dark",c.value)})}await R()}catch(a){console.error("Initialization error:",a)}finally{_.value=!1}}),(o,a)=>(r(),Z(t(tt),null,{default:n(()=>[e(t(lt),{class:"ion-no-border"},{default:n(()=>[e(t(at),null,{default:n(()=>[e(t(H),{slot:"start"},{default:n(()=>[e(t(nt),{class:"toolbar-avatar"},{default:n(()=>[s("img",{src:j.value,alt:"Student"},null,8,vt)]),_:1})]),_:1}),e(t(ot),{class:"toolbar-title"},{default:n(()=>[s("div",mt,u(G.value),1),s("div",ht,u(t(z)),1)]),_:1}),e(t(H),{slot:"end"},{default:n(()=>[e(t(f),{onClick:$,fill:"clear"},{default:n(()=>[e(t(i),{icon:t(st),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),e(t(pt),{fullscreen:!0},{default:n(()=>[_.value?(r(),d("div",kt,[e(t(it),{name:"crescent"}),a[0]||(a[0]=s("p",null,"Loading your data...",-1))])):(r(),d("div",yt,[e(t(T),{class:"content-card"},{default:n(()=>[e(t(N),null,{default:n(()=>[e(t(D),null,{default:n(()=>[e(t(i),{icon:t(P)},null,8,["icon"]),a[1]||(a[1]=l(" Recent Updates ",-1))]),_:1})]),_:1}),e(t(A),null,{default:n(()=>[I.value?(r(),d("div",wt,[s("p",null,u(F(I.value.notification_body,100)),1),e(t(q),null,{default:n(()=>[l(u(B(I.value.created_at)),1)]),_:1})])):(r(),d("div",It,[e(t(i),{icon:t(rt)},null,8,["icon"]),a[2]||(a[2]=s("p",null,"No recent updates",-1))])),e(t(f),{expand:"block",fill:"clear",size:"small",onClick:E,class:"view-all-button"},{default:n(()=>[...a[3]||(a[3]=[l(" View All Notifications ",-1)])]),_:1})]),_:1})]),_:1}),e(t(T),{class:"content-card"},{default:n(()=>[e(t(N),null,{default:n(()=>[e(t(D),null,{default:n(()=>[e(t(i),{icon:t(ct)},null,8,["icon"]),a[4]||(a[4]=l(" Recent Attendance ",-1))]),_:1})]),_:1}),e(t(A),null,{default:n(()=>[b.value?(r(),d("div",bt,[s("p",null,[a[5]||(a[5]=l(" You were marked ",-1)),s("strong",null,u(b.value.student_attendance),1)]),e(t(q),null,{default:n(()=>[l(u(B(b.value.created_at)),1)]),_:1})])):(r(),d("div",Ct,[e(t(i),{icon:t(ut)},null,8,["icon"]),a[6]||(a[6]=s("p",null,"No attendance records yet",-1))]))]),_:1})]),_:1}),e(t(T),{class:"content-card"},{default:n(()=>[e(t(N),null,{default:n(()=>[e(t(D),null,{default:n(()=>[e(t(i),{icon:t(dt)},null,8,["icon"]),a[7]||(a[7]=l(" Quick Actions ",-1))]),_:1})]),_:1}),e(t(A),null,{default:n(()=>[s("div",St,[e(t(f),{fill:"clear",class:"quick-action-button",onClick:J},{default:n(()=>[s("div",Tt,[e(t(i),{icon:t(ft)},null,8,["icon"])]),e(t(O),null,{default:n(()=>[...a[8]||(a[8]=[l("Classes",-1)])]),_:1})]),_:1}),e(t(f),{fill:"clear",class:"quick-action-button",onClick:E},{default:n(()=>[s("div",Nt,[e(t(i),{icon:t(P)},null,8,["icon"])]),e(t(O),null,{default:n(()=>[...a[9]||(a[9]=[l("Notifications",-1)])]),_:1})]),_:1}),e(t(f),{fill:"clear",class:"quick-action-button",onClick:Y},{default:n(()=>[s("div",Dt,[e(t(i),{icon:t(gt)},null,8,["icon"])]),e(t(O),null,{default:n(()=>[...a[10]||(a[10]=[l("Settings",-1)])]),_:1})]),_:1})])]),_:1})]),_:1})]))]),_:1})]),_:1}))}}),Et=_t(At,[["__scopeId","data-v-ab7ae528"]]);export{Et as default};
